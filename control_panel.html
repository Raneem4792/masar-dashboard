<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>لوحة التحكم - Head Nurse Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Tajawal", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #F7F9FD;
      background-attachment: fixed;
      min-height: 100vh;
      color: #1A3A7A;
    }

    :root {
      --primary: #0A1D41;
      --primary-dark: #0A1D41;
      --secondary: #A8AD63;
      --complement: #8A8F40;
      --interactive: #1A3A7A;
      --accent: #A8AD63;
      --bg-card: #ffffff;
      --bg-light: #FFFFFF;
      --border-soft: rgba(195, 199, 115, 0.5);
      --danger: #e53935;
      --warning: #ffb300;
      --success: #2e7d32;
      --muted: #90a4ae;
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--primary);
      color: #FFFFFF;
      letter-spacing: 0.5px;
      padding: 18px 28px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo-circle {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      background: rgba(10, 86, 179, 0.15);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.2);
    }

    .header-title {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .header-title-main {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .header-title-sub {
      font-size: 13px;
      opacity: 0.92;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .mobile-header {
      display: none;
      background: #0A1D41;
      color: #ffffff;
      padding: 14px 20px;
      font-size: 18px;
      font-weight: 700;
      align-items: center;
      justify-content: space-between;
    }

    .mobile-menu-btn {
      font-size: 26px;
      cursor: pointer;
    }

    .mobile-menu {
      display: none;
      position: fixed;
      inset-inline-start: 0;
      top: 0;
      height: 100vh;
      width: 260px;
      background: #0A1D41;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      z-index: 9999;
      overflow-y: auto;
    }

    .mobile-menu a {
      display: block;
      color: #ffffff;
      padding: 14px 0;
      font-size: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      text-decoration: none;
    }

    .mobile-menu-close {
      color: #ffffff;
      font-size: 26px;
      text-align: end;
      cursor: pointer;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      header,
      .top-buttons {
        display: none !important;
      }

      .mobile-header {
        display: flex !important;
      }
    }

    .btn-nav {
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      padding: 9px 18px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.12);
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-nav:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
    }

    .btn-nav:active {
      transform: translateY(0);
    }

    main {
      flex: 1;
      padding: 24px;
      max-width: 1600px;
      margin: 0 auto;
      width: 100%;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: linear-gradient(180deg, #ffffff, #f7f9fc);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 6px 20px rgba(10, 29, 65, 0.08);
      border: 1px solid rgba(10, 29, 65, 0.08);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      width: 100%;
    }

    .card:hover {
      box-shadow: 0 12px 32px rgba(15, 37, 85, 0.12);
      transform: translateY(-2px);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid rgba(10, 86, 179, 0.08);
    }

    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--secondary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-icon {
      font-size: 24px;
    }

    .card-subtitle {
      font-size: 12px;
      color: #243A5A;
      margin-top: 4px;
    }

    .full-width-card {
      grid-column: 1 / -1;
    }

    /* Hospital overview */
    .hospital-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
    }

    .hospital-card {
      border-radius: 18px;
      padding: 16px 16px 14px;
      background: linear-gradient(135deg, #f4f8ff, #ffffff);
      border: 1px solid rgba(10, 86, 179, 0.1);
      box-shadow: 0 8px 20px rgba(15, 37, 85, 0.08);
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .hospital-card::after {
      content: '';
      position: absolute;
      inset-inline-end: -40px;
      top: -40px;
      width: 120px;
      height: 120px;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(24,164,224,0.18), transparent 60%);
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .hospital-card:hover::after {
      opacity: 1;
    }

    .hospital-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 14px 30px rgba(15, 37, 85, 0.16);
      border-color: var(--primary);
    }

    .hospital-card.selected {
      border: 2px solid var(--primary);
      box-shadow: 0 0 0 3px rgba(10,86,179,0.22);
    }

    .hospital-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .hospital-name {
      font-size: 17px;
      font-weight: 700;
      color: #0A1D41;
    }

    .hospital-meta {
      font-size: 12px;
      color: #243A5A;
    }

    .tag {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 600;
    }

    .tag-open {
      background: rgba(46,125,50,0.12);
      color: var(--success);
    }

    .tag-limited {
      background: rgba(255,179,0,0.14);
      color: var(--warning);
    }

    .tag-closed {
      background: rgba(229,57,53,0.14);
      color: var(--danger);
    }

    .hospital-stats-row {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 12px;
    }

    .hospital-stat-label {
      color: var(--muted);
      font-size: 11px;
    }

    .hospital-stat-value {
      font-weight: 600;
    }

    .capacity-bar {
      width: 100%;
      height: 7px;
      border-radius: 999px;
      background: #e2e7f5;
      margin-top: 10px;
      overflow: hidden;
    }

    .capacity-fill {
      height: 100%;
      border-radius: 999px;
      transition: width 0.3s ease;
    }

    .capacity-fill.good {
      background: linear-gradient(90deg, #2e7d32, #66bb6a);
    }

    .capacity-fill.warning {
      background: linear-gradient(90deg, #ffb300, #ffca28);
    }

    .capacity-fill.critical {
      background: linear-gradient(90deg, #e53935, #ef5350);
    }

    .hospital-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      font-size: 11px;
      color: var(--muted);
    }

    .hospital-load-text {
      font-weight: 600;
      color: var(--primary-dark);
    }

    /* Nurse to Patient Ratio */
    .ratio-display {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .ratio-card {
      background: linear-gradient(135deg, #f0f7ff, #e8f3ff);
      border-radius: 16px;
      padding: 20px;
      border: 2px solid rgba(10, 86, 179, 0.1);
    }

    .ratio-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .ratio-label {
      font-size: 14px;
      color: var(--muted);
      font-weight: 500;
    }

    .ratio-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary-dark);
    }

    .ratio-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
    }

    .ratio-status.good {
      background: rgba(46, 125, 50, 0.15);
      color: var(--success);
    }

    .ratio-status.warning {
      background: rgba(255, 179, 0, 0.15);
      color: var(--warning);
    }

    .ratio-status.critical {
      background: rgba(229, 57, 53, 0.15);
      color: var(--danger);
    }

    .ratio-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 16px;
    }

    .detail-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .detail-label {
      font-size: 11px;
      color: var(--muted);
      font-weight: 500;
    }

    .detail-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary-dark);
    }

    /* Equipment Status */
    .equipment-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .equipment-item {
      background: linear-gradient(135deg, #ffffff, #f8faff);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid rgba(10, 86, 179, 0.1);
      transition: all 0.2s ease;
    }

    .equipment-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(15, 37, 85, 0.1);
      border-color: var(--primary);
    }

    .equipment-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--primary-dark);
      margin-bottom: 8px;
    }

    .equipment-status {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .equipment-count {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary-dark);
    }

    .equipment-available {
      font-size: 11px;
      color: var(--success);
      font-weight: 600;
    }

    .equipment-unavailable {
      font-size: 11px;
      color: var(--danger);
      font-weight: 600;
    }

    /* AI Transfer Recommendations */
    .ai-recommendations {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .recommendation-card {
      background: linear-gradient(135deg, #fff9f0, #fff5e6);
      border-radius: 16px;
      padding: 20px;
      border: 2px solid rgba(255, 179, 0, 0.2);
      position: relative;
      overflow: hidden;
    }

    .recommendation-card::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 4px;
      height: 100%;
      background: var(--warning);
    }

    .recommendation-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .patient-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .patient-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--primary-dark);
    }

    .patient-id {
      font-size: 12px;
      color: var(--muted);
    }

    .priority-badge {
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .priority-high {
      background: rgba(229, 57, 53, 0.15);
      color: var(--danger);
    }

    .priority-medium {
      background: rgba(255, 179, 0, 0.15);
      color: var(--warning);
    }

    .priority-low {
      background: rgba(46, 125, 50, 0.15);
      color: var(--success);
    }

    .ai-analysis {
      background: rgba(24, 164, 224, 0.08);
      border-radius: 12px;
      padding: 12px;
      margin: 12px 0;
    }

    .ai-label {
      font-size: 11px;
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .ai-text {
      font-size: 13px;
      color: var(--primary-dark);
      line-height: 1.6;
      font-weight: 500;
    }

    .recommendation-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 12px;
    }

    .recommendation-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .recommendation-label {
      font-size: 11px;
      color: var(--muted);
      font-weight: 500;
    }

    .recommendation-value {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary-dark);
    }

    .recommendation-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .btn-action {
      flex: 1;
      padding: 10px 16px;
      border-radius: 10px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary-action {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: #fff;
      box-shadow: 0 4px 12px rgba(10, 86, 179, 0.3);
    }

    .btn-primary-action:hover {
      box-shadow: 0 6px 18px rgba(10, 86, 179, 0.4);
      transform: translateY(-2px);
    }

    .btn-secondary-action {
      background: #f0f4ff;
      color: var(--primary-dark);
      border: 1px solid rgba(10, 86, 179, 0.2);
    }

    .btn-secondary-action:hover {
      background: #e0ebff;
      border-color: var(--primary);
    }

    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
    }

    @media (max-width: 768px) {
      main {
        padding: 16px;
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .full-width-card {
        grid-column: 1;
      }
    }
  </style>
</head>
<body>
<div class="mobile-header">
  <span class="mobile-menu-btn" onclick="openMenu()">☰</span>
  <span>Masar</span>
</div>

<div id="mobileMenu" class="mobile-menu">
  <div class="mobile-menu-close" onclick="closeMenu()">×</div>
  <a href="main_dashboard.html">الرئيسية</a>
  <a href="smart_beds.html">خريطة الأسرة</a>
  <a href="control_panel.html">لوحة التحكم</a>
  <a href="transfer_requests.html">إدارة الطلبات</a>
</div>

<div class="app-shell">
  <header>
    <div class="header-left">
      <div class="logo-circle" aria-hidden="true"></div>
      <div class="header-title">
        <div class="header-title-main">Masar</div>
        <div class="header-title-sub">لوحة التحكم</div>
      </div>
    </div>
    <div class="header-actions">
      <a href="main_dashboard.html" class="btn-nav">الرئيسية</a>
      <a href="smart_beds.html" class="btn-nav">خريطة الأسرة</a>
      <a href="transfer_requests.html" class="btn-nav">إدارة الطلبات</a>
    </div>
  </header>

  <main>
    <div class="dashboard-grid">
      <!-- ملخص المستشفيات الثلاثة -->
      <div class="card full-width-card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <span class="card-icon"></span>
              ملخص سعة المستشفيات في التجمع
            </div>
            <div class="card-subtitle">
              اختر مستشفى لعرض تفاصيل نسبة التمريض/المرضى، واستخدامه في قرارات النقل.
            </div>
          </div>
        </div>
        <div id="hospitalsGrid" class="hospital-grid">
          <!-- تُبنى من JavaScript -->
        </div>
      </div>

      <!-- نسبة الممرضين/المرضى -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <span class="card-icon"></span>
            نسبة الممرضين / المرضى حسب المستشفى المحدد
          </div>
        </div>
        <div class="ratio-display">
          <div class="ratio-card">
            <div class="ratio-header">
              <div class="ratio-label" id="ratioHospitalName">النسبة الحالية</div>
              <span class="ratio-status" id="ratioStatusBadge">—</span>
            </div>
            <div class="ratio-value" id="currentRatioValue">—</div>
            <div class="ratio-details">
              <div class="detail-item">
                <span class="detail-label">إجمالي الممرضين</span>
                <span class="detail-value" id="currentNurses">—</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">إجمالي المرضى</span>
                <span class="detail-value" id="currentPatients">—</span>
              </div>
            </div>
          </div>
          <div class="ratio-card">
            <div class="ratio-header">
              <div class="ratio-label">النسبة المستهدفة (Ideal)</div>
              <span class="ratio-status good">مستهدف</span>
            </div>
            <div class="ratio-value" id="idealRatioValue">1 : 5</div>
            <div class="ratio-details">
              <div class="detail-item">
                <span class="detail-label">عدد الممرضين المطلوب</span>
                <span class="detail-value" id="requiredNurses">—</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">نقص في التغطية</span>
                <span class="detail-value" id="nurseGap">—</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- الأجهزة المتوفرة -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <span class="card-icon"></span>
            الأجهزة المتوفرة في المستشفى المحدد
          </div>
        </div>
        <div class="equipment-grid">
          <div class="equipment-item">
            <div class="equipment-name">أجهزة التنفس الصناعي</div>
            <div class="equipment-status">
              <span class="equipment-count">12/15</span>
              <span class="equipment-available">3 متاح</span>
            </div>
          </div>
          <div class="equipment-item">
            <div class="equipment-name">مراقبة القلب</div>
            <div class="equipment-status">
              <span class="equipment-count">28/30</span>
              <span class="equipment-available">2 متاح</span>
            </div>
          </div>
          <div class="equipment-item">
            <div class="equipment-name">مضخات التسريب</div>
            <div class="equipment-status">
              <span class="equipment-count">45/50</span>
              <span class="equipment-available">5 متاح</span>
            </div>
          </div>
          <div class="equipment-item">
            <div class="equipment-name">أجهزة قياس الضغط</div>
            <div class="equipment-status">
              <span class="equipment-count">38/40</span>
              <span class="equipment-available">2 متاح</span>
            </div>
          </div>
          <div class="equipment-item">
            <div class="equipment-name">أجهزة الأكسجين</div>
            <div class="equipment-status">
              <span class="equipment-count">22/25</span>
              <span class="equipment-available">3 متاح</span>
            </div>
          </div>
          <div class="equipment-item">
            <div class="equipment-name">أجهزة غسيل الكلى</div>
            <div class="equipment-status">
              <span class="equipment-count">8/10</span>
              <span class="equipment-available">2 متاح</span>
            </div>
          </div>
        </div>
      </div>

      <!-- مقترحات النقل المدعمة بالذكاء الاصطناعي -->
      <div class="card full-width-card">
        <div class="card-header">
          <div class="card-title">
            <span class="card-icon"></span>
            مقترحات النقل المدعمة بالذكاء الاصطناعي
          </div>
        </div>
        <div class="ai-recommendations" id="aiRecommendations">
          <!-- سيتم ملؤها من JavaScript -->
        </div>
      </div>
    </div>
  </main>
</div>

<script>
  // بيانات المستشفيات الثلاثة
  const hospitals = [
    {
      id: 'KAH',
      name: 'مستشفى الملك عبدالعزيز',
      code: 'KAH',
      totalBeds: 240,
      occupiedBeds: 210,
      criticalPatients: 18,
      nurses: 35,
      patients: 210,
      transferStatus: 'limited',
      transferStatusText: 'قبول محدود',
      travelTime: '— (المستشفى الحالي)'
    },
    {
      id: 'NOOR',
      name: 'مستشفى النور التخصصي',
      code: 'NOOR',
      totalBeds: 260,
      occupiedBeds: 190,
      criticalPatients: 12,
      nurses: 42,
      patients: 190,
      transferStatus: 'open',
      transferStatusText: 'متاح لاستقبال النقل',
      travelTime: '45 دقيقة'
    },
    {
      id: 'KAMC',
      name: 'مدينة الملك عبدالله الطبية',
      code: 'KAMC',
      totalBeds: 300,
      occupiedBeds: 220,
      criticalPatients: 25,
      nurses: 50,
      patients: 220,
      transferStatus: 'open',
      transferStatusText: 'متاح لاستقبال النقل (تخصصي)',
      travelTime: '20 دقيقة'
    }
  ];

  let selectedHospitalId = 'KAH';

  // بيانات مقترحات النقل (كما هي عندك)
  const transferRecommendations = [
    {
      patientName: 'سعاد أحمد محمد',
      patientId: 'MRN-2024-001234',
      currentWard: 'الجناح 4B - باطنية',
      priority: 'high',
      aiAnalysis: 'الحالة مستقرة نسبياً لكن تحتاج متابعة مستمرة. الجناح الحالي يعاني من ضغط عالي (نسبة ممرض/مريض 1:7). يُنصح بالنقل لتخفيف الحمل.',
      recommendedHospital: 'مستشفى حراء',
      recommendedWard: 'الجناح 3D - نساء',
      availableBeds: 8,
      estimatedTransferTime: '30 دقيقة',
      reason: 'توفر أجهزة متخصصة + نسبة ممرض/مريض أفضل (1:5)'
    },
    {
      patientName: 'وفاء العتيبي',
      patientId: 'MRN-2024-001567',
      currentWard: 'الجناح 3A - جراحة',
      priority: 'medium',
      aiAnalysis: 'المريضة في مرحلة التعافي وتحتاج رعاية أقل كثافة. يمكن نقلها إلى جناح أقل ضغطاً لتحرير سرير للحالات الحرجة.',
      recommendedHospital: 'مستشفى النور التخصصي',
      recommendedWard: 'الجناح 2A - عيون',
      availableBeds: 5,
      estimatedTransferTime: '45 دقيقة',
      reason: 'قرب من مكان السكن + توفر سرير في جناح مناسب'
    },
    {
      patientName: 'حصة القحطاني',
      patientId: 'MRN-2024-001890',
      currentWard: 'الجناح 4B - باطنية',
      priority: 'high',
      aiAnalysis: 'حالة حرجة تحتاج أجهزة متخصصة غير متوفرة في الجناح الحالي. النقل ضروري لضمان الرعاية المثلى.',
      recommendedHospital: 'مدينة الملك عبدالله الطبية',
      recommendedWard: 'الجناح 5C - قلب',
      availableBeds: 3,
      estimatedTransferTime: '20 دقيقة',
      reason: 'توفر أجهزة متخصصة للقلب + فريق طبي متخصص'
    },
    {
      patientName: 'مشاعل المطيري',
      patientId: 'MRN-2024-002134',
      currentWard: 'الجناح 2C - عظام',
      priority: 'low',
      aiAnalysis: 'المريضة في حالة مستقرة تماماً وتستعد للخروج خلال 24-48 ساعة. يمكن نقلها إلى جناح أقل تكلفة أو إبقاؤها في المكان الحالي.',
      recommendedHospital: 'مستشفى الولادة والأطفال',
      recommendedWard: 'الجناح 1A - ولادة',
      availableBeds: 7,
      estimatedTransferTime: '60 دقيقة',
      reason: 'تحرير سرير في جناح عظام للحالات الحرجة'
    }
  ];

  const hospitalsGrid = document.getElementById('hospitalsGrid');
  const aiRecommendations = document.getElementById('aiRecommendations');

  const ratioHospitalName = document.getElementById('ratioHospitalName');
  const ratioStatusBadge = document.getElementById('ratioStatusBadge');
  const currentRatioValue = document.getElementById('currentRatioValue');
  const currentNurses = document.getElementById('currentNurses');
  const currentPatients = document.getElementById('currentPatients');
  const idealRatioValue = document.getElementById('idealRatioValue');
  const requiredNurses = document.getElementById('requiredNurses');
  const nurseGap = document.getElementById('nurseGap');

  function getLoadClass(loadPercent) {
    if (loadPercent >= 85) return 'critical';
    if (loadPercent >= 70) return 'warning';
    return 'good';
  }

  function getLoadText(loadPercent) {
    if (loadPercent >= 90) return 'حرج جداً';
    if (loadPercent >= 75) return 'مرتفع';
    if (loadPercent >= 50) return 'متوسط';
    return 'منخفض';
  }

  function getTransferTagClass(status) {
    switch (status) {
      case 'open': return 'tag-open';
      case 'limited': return 'tag-limited';
      case 'closed': return 'tag-closed';
      default: return '';
    }
  }

  function formatRatio(nurses, patients) {
    if (!nurses || !patients) return '—';
    const r = (patients / nurses).toFixed(1);
    return `1 : ${r}`;
  }

  function updateRatioFromHospital(h) {
    const ratio = h.nurses && h.patients ? (h.patients / h.nurses) : null;
    const ideal = 5; // 1:5

    ratioHospitalName.textContent = `النسبة الحالية – ${h.name}`;
    currentRatioValue.textContent = ratio ? `1 : ${ratio.toFixed(1)}` : '—';
    currentNurses.textContent = h.nurses;
    currentPatients.textContent = h.patients;

    idealRatioValue.textContent = `1 : ${ideal}`;

    const needed = h.patients ? Math.ceil(h.patients / ideal) : 0;
    requiredNurses.textContent = needed;
    const gap = needed - h.nurses;
    nurseGap.textContent = gap > 0 ? gap : 0;

    // لون حالة النسبة
    ratioStatusBadge.classList.remove('good', 'warning', 'critical');

    if (!ratio) {
      ratioStatusBadge.textContent = '—';
    } else if (ratio <= ideal) {
      ratioStatusBadge.textContent = 'ممتاز';
      ratioStatusBadge.classList.add('good');
    } else if (ratio <= ideal + 1.5) {
      ratioStatusBadge.textContent = 'تحذير';
      ratioStatusBadge.classList.add('warning');
    } else {
      ratioStatusBadge.textContent = 'حرج';
      ratioStatusBadge.classList.add('critical');
    }
  }

  function buildHospitals() {
    hospitalsGrid.innerHTML = '';
    hospitals.forEach(h => {
      const freeBeds = h.totalBeds - h.occupiedBeds;
      const loadPercent = Math.round((h.occupiedBeds / h.totalBeds) * 100);
      const loadClass = getLoadClass(loadPercent);
      const loadText = getLoadText(loadPercent);
      const ratioText = formatRatio(h.nurses, h.patients);

      const card = document.createElement('div');
      card.className = 'hospital-card' + (h.id === selectedHospitalId ? ' selected' : '');
      card.innerHTML = `
        <div class="hospital-header">
          <div>
            <div class="hospital-name">${h.name}</div>
            <div class="hospital-meta">${h.code} • وقت النقل: ${h.travelTime}</div>
          </div>
          <span class="tag ${getTransferTagClass(h.transferStatus)}">${h.transferStatusText}</span>
        </div>

        <div class="hospital-stats-row">
          <div>
            <div class="hospital-stat-label">الأسرّة المشغولة / الإجمالي</div>
            <div class="hospital-stat-value">${h.occupiedBeds} / ${h.totalBeds}</div>
          </div>
          <div>
            <div class="hospital-stat-label">أسِرّة متاحة</div>
            <div class="hospital-stat-value" style="color: var(--success);">${freeBeds}</div>
          </div>
        </div>

        <div class="hospital-stats-row">
          <div>
            <div class="hospital-stat-label">الحالات الحرجة</div>
            <div class="hospital-stat-value" style="color: var(--danger);">${h.criticalPatients}</div>
          </div>
          <div>
            <div class="hospital-stat-label">نسبة الممرضين/المرضى</div>
            <div class="hospital-stat-value">${ratioText}</div>
          </div>
        </div>

        <div class="capacity-bar">
          <div class="capacity-fill ${loadClass}" style="width: ${loadPercent}%;"></div>
        </div>

        <div class="hospital-footer">
          <span>ضغط المستشفى: <span class="hospital-load-text">${loadText} (${loadPercent}%)</span></span>
          <span>للقرار السريع في النقل بين المستشفيات</span>
        </div>
      `;

      card.addEventListener('click', () => {
        selectedHospitalId = h.id;
        // تحديث اختيار الكروت
        document.querySelectorAll('.hospital-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        // تحديث النسبة
        updateRatioFromHospital(h);
      });

      hospitalsGrid.appendChild(card);
    });
  }

  function getPriorityClass(priority) {
    switch (priority) {
      case 'high': return 'priority-high';
      case 'medium': return 'priority-medium';
      case 'low': return 'priority-low';
      default: return '';
    }
  }

  function getPriorityText(priority) {
    switch (priority) {
      case 'high': return 'عالية';
      case 'medium': return 'متوسطة';
      case 'low': return 'منخفضة';
      default: return '';
    }
  }

  function buildRecommendations() {
    aiRecommendations.innerHTML = '';

    transferRecommendations.forEach((rec, index) => {
      const card = document.createElement('div');
      card.className = 'recommendation-card';
      card.style.animationDelay = `${index * 0.1}s`;

      card.innerHTML = `
        <div class="recommendation-header">
          <div class="patient-info">
            <div class="patient-name">${rec.patientName}</div>
            <div class="patient-id">${rec.patientId} | ${rec.currentWard}</div>
          </div>
          <span class="priority-badge ${getPriorityClass(rec.priority)}">
            أولوية ${getPriorityText(rec.priority)}
          </span>
        </div>

        <div class="ai-analysis">
          <div class="ai-label">
             تحليل الذكاء الاصطناعي
          </div>
          <div class="ai-text">
            ${rec.aiAnalysis}
          </div>
        </div>

        <div class="recommendation-details">
          <div class="recommendation-item">
            <span class="recommendation-label">المستشفى المقترح</span>
            <span class="recommendation-value">${rec.recommendedHospital}</span>
          </div>
          <div class="recommendation-item">
            <span class="recommendation-label">الجناح المقترح</span>
            <span class="recommendation-value">${rec.recommendedWard}</span>
          </div>
          <div class="recommendation-item">
            <span class="recommendation-label">الأسرة المتاحة</span>
            <span class="recommendation-value" style="color: var(--success);">${rec.availableBeds} سرير</span>
          </div>
          <div class="recommendation-item">
            <span class="recommendation-label">وقت النقل المتوقع</span>
            <span class="recommendation-value">${rec.estimatedTransferTime}</span>
          </div>
        </div>

        <div style="margin-top: 12px; padding: 10px; background: rgba(10, 86, 179, 0.05); border-radius: 8px;">
          <div style="font-size: 11px; color: var(--muted); margin-bottom: 4px;">سبب التوصية:</div>
          <div style="font-size: 12px; color: var(--primary-dark); font-weight: 500;">${rec.reason}</div>
        </div>

        <div class="recommendation-actions">
          <button class="btn-action btn-primary-action" onclick="initiateTransfer('${rec.patientId}', '${rec.recommendedHospital}')">
            بدء عملية النقل
          </button>
          <button class="btn-action btn-secondary-action" onclick="viewDetails('${rec.patientId}')">
            التفاصيل الكاملة
          </button>
        </div>
      `;

      aiRecommendations.appendChild(card);
    });
  }

  function initiateTransfer(patientId, hospital) {
    if (confirm(`هل أنت متأكد من بدء عملية نقل المريض ${patientId} إلى ${hospital}؟`)) {
      alert(` تم بدء عملية النقل للمريض ${patientId}\nسيتم إشعار الفريق الطبي والمواصلات.`);
    }
  }

  function viewDetails(patientId) {
    alert(`عرض التفاصيل الكاملة للمريض: ${patientId}\n(سيتم فتح صفحة التفاصيل الكاملة)`);
  }

  function init() {
    buildHospitals();
    // تحديث النسبة للمستشفى الافتراضي (الملك عبدالعزيز)
    const defaultHospital = hospitals.find(h => h.id === selectedHospitalId) || hospitals[0];
    updateRatioFromHospital(defaultHospital);
    buildRecommendations();
  }

  document.addEventListener('DOMContentLoaded', init);
</script>

<script>
  function openMenu() {
    const menu = document.getElementById('mobileMenu');
    if (menu) {
      menu.style.display = 'block';
    }
  }

  function closeMenu() {
    const menu = document.getElementById('mobileMenu');
    if (menu) {
      menu.style.display = 'none';
    }
  }
</script>
</body>
</html>

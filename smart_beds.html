<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø±Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ¶ÙŠØ© Ø§Ù„Ø°ÙƒÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Ø®Ø· ØªØ¬Ù…ÙŠÙ„ÙŠ -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Tajawal", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #F7F9FD;
      color: #1A3A7A;
    }

    :root {
      --primary: #0A1D41;
      --primary-dark: #0A1D41;
      --secondary: #A8AD63;
      --complement: #8A8F40;
      --interactive: #1A3A7A;
      --accent: #A8AD63;
      --bg-card: #ffffff;
      --bg-light: #FFFFFF;
      --border-soft: rgba(195, 199, 115, 0.5);
      --danger: #e53935;
      --warning: #ffb300;
      --success: #2e7d32;
      --isolation: #7b1fa2;
      --muted: #90a4ae;
    }

    body {
      background: #F7F9FD;
      min-height: 100vh;
      padding-bottom: 40px;
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--primary);
      color: #FFFFFF;
      padding: 18px 26px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      border-bottom: 2px solid rgba(255, 255, 255, 0.15);
      position: sticky;
      top: 0;
      z-index: 20;
      letter-spacing: 0.5px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo-circle {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 15px;
      background: rgba(10, 86, 179, 0.1);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.15);
    }

    .header-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .header-title-main {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .header-title-sub {
      font-size: 13px;
      opacity: 0.9;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø®ØµØµ Ù„Ù„Ø¬ÙˆØ§Ù„ */
    .mobile-header {
      display: none;
      background: #0A1D41;
      color: #ffffff;
      padding: 14px 20px;
      font-size: 18px;
      font-weight: 700;
      align-items: center;
      justify-content: space-between;
    }

    .mobile-menu-btn {
      font-size: 26px;
      cursor: pointer;
    }

    .mobile-menu {
      display: none;
      position: fixed;
      inset-inline-start: 0;
      top: 0;
      height: 100vh;
      width: 260px;
      background: #0A1D41;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      z-index: 9999;
      overflow-y: auto;
    }

    .mobile-menu a {
      display: block;
      color: #ffffff;
      padding: 14px 0;
      font-size: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      text-decoration: none;
    }

    .mobile-menu-close {
      color: #ffffff;
      font-size: 26px;
      text-align: end;
      cursor: pointer;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      header,
      .top-buttons {
        display: none !important;
      }

      .mobile-header {
        display: flex !important;
      }
    }

    .nav-link {
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      padding: 9px 18px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.12);
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
    }

    .nav-link:active {
      transform: translateY(0);
    }

    .tag-season {
      font-size: 12px;
      font-weight: 600;
      padding: 8px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background: linear-gradient(135deg, rgba(3, 169, 244, 0.25), rgba(3, 169, 244, 0.15));
      display: inline-flex;
      align-items: center;
      gap: 6px;
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .season-toggle {
      border-radius: 14px;
      border: 2px solid rgba(255, 255, 255, 0.4);
      padding: 9px 18px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.15);
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
    }

    .season-toggle.active {
      background: linear-gradient(135deg, #ffb300, #ffa000);
      color: #000;
      border-color: #ffb300;
      box-shadow: 0 4px 16px rgba(255, 179, 0, 0.4);
      font-weight: 700;
    }

    .season-toggle:hover {
      background: rgba(255, 255, 255, 0.28);
      transform: translateY(-2px);
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .season-toggle.active:hover {
      background: linear-gradient(135deg, #ffc107, #ffb300);
      box-shadow: 0 6px 20px rgba(255, 179, 0, 0.5);
    }

    .user-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid rgba(255, 255, 255, 0.2);
      font-size: 13px;
      font-weight: 500;
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .user-chip:hover {
      background: rgba(255, 255, 255, 0.18);
      transform: translateY(-1px);
    }

    .user-avatar {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 12px;
      color: var(--primary-dark);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    main {
      flex: 1;
      padding: 14px 18px 22px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .layout {
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr) 320px;
      gap: 14px;
      align-items: stretch;
    }

    .ai-analysis-card {
      grid-column: 2;
      margin-top: 14px;
    }

    @media (max-width: 1100px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }

      .ai-analysis-card {
        grid-column: 1;
      }

      .side-panel,
      .details-panel {
        order: -1;
      }
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }

      .side-panel,
      .details-panel {
        order: 0;
        width: 100%;
      }
    }

    .card {
      background: linear-gradient(180deg, #ffffff, #f7f9fc);
      border-radius: 22px;
      padding: 26px;
      border: 1px solid var(--border-soft);
      box-shadow: 0 6px 20px rgba(10, 29, 65, 0.08);
      backdrop-filter: blur(2px);
      transition: all 0.25s ease;
      width: 100%;
    }

    .details-panel {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .details-panel .details {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .card:hover {
      box-shadow: 0 12px 32px rgba(15, 37, 85, 0.15);
      transform: translateY(-2px);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--secondary);
      letter-spacing: -0.01em;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--muted);
    }

    .badge-light {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--bg-light);
      color: var(--interactive);
    }

    /* Sidebar Filters */
    .filters {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .field-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 6px;
      letter-spacing: -0.01em;
    }

    select {
      width: 100%;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      font-size: 13px;
      outline: none;
      background: var(--bg-light);
      transition: all 0.2s ease;
      font-weight: 500;
    }

    select:hover {
      border-color: var(--complement);
    }

    select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(10, 29, 65, 0.1);
      background: #ffffff;
    }

    .quick-stats {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 6px;
    }

    .stat-badge {
      padding: 10px;
      border-radius: 12px;
      background: var(--bg-light);
      border: 1px solid var(--border-soft);
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      transition: all 0.2s ease;
    }

    .stat-badge:hover {
      background: linear-gradient(180deg, #ffffff, #f7f9fc);
      border-color: var(--complement);
      box-shadow: 0 2px 8px rgba(10, 29, 65, 0.08);
    }

    .stat-badge strong {
      font-size: 15px;
      font-weight: 700;
      color: var(--complement);
    }

    .stat-badge span {
      color: var(--muted);
      font-weight: 500;
    }

    /* Map + Legend */
    .map-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .map-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .pill-group {
      display: inline-flex;
      padding: 3px;
      border-radius: 12px;
      background: #edf3ff;
      gap: 3px;
    }

    .pill {
      border-radius: 10px;
      padding: 4px 10px;
      font-size: 12px;
      border: none;
      background: transparent;
      cursor: pointer;
      color: var(--primary-dark);
      opacity: 0.6;
      transition: all 0.2s ease;
    }

    .pill.active {
      background: #ffffff;
      opacity: 1;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(10, 56, 145, 0.12);
    }

    .map-wrapper {
      border-radius: 20px;
      border: 1px solid rgba(10, 56, 145, 0.08);
      background: radial-gradient(circle at top, #ffffff 0%, #f5f7fb 45%, #eef2fb 100%);
      padding: 20px;
      position: relative;
      overflow: hidden;
      min-height: 260px;
      box-shadow: inset 0 2px 8px rgba(15, 37, 85, 0.04);
    }

    .ward-label {
      position: absolute;
      top: 12px;
      inset-inline-start: 16px;
      font-size: 13px;
      font-weight: 600;
      color: var(--muted);
      letter-spacing: -0.01em;
    }

    .bed-grid {
      display: grid;
      grid-template-columns: repeat(6, minmax(0, 1fr));
      gap: 12px;
      margin-top: 32px;
    }

    @media (max-width: 900px) {
      .bed-grid {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }

    @media (max-width: 600px) {
      .bed-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    @media (max-width: 450px) {
      .bed-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .bed {
      position: relative;
      border-radius: 16px;
      padding: 10px 8px;
      background: #ffffff;
      border: 1px solid rgba(0, 0, 0, 0.06);
      box-shadow: 0 8px 20px rgba(15, 37, 85, 0.06);
      cursor: pointer;
      overflow: hidden;
      transition: all 0.22s ease;
    }

    .bed:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 28px rgba(15, 37, 85, 0.12);
      border-color: var(--primary);
    }

    .bed.selected {
      border: 2px solid #0a56b3;
      box-shadow: 0 0 0 4px rgba(10, 86, 179, 0.18),
        0 12px 30px rgba(15, 37, 85, 0.2);
    }

    .bed-head {
      position: absolute;
      top: 0;
      inset-inline-start: 0;
      width: 100%;
      height: 12px;
      background: linear-gradient(90deg, #0b0e5b, #0a56b3);
    }

    .bed-body {
      margin-top: 12px;
      border-radius: 10px;
      border: 1px solid rgba(10, 86, 179, 0.06);
      padding: 8px 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      background: linear-gradient(135deg, #ffffff, #f5f8ff);
    }

    .bed-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
    }

    .bed-id {
      font-size: 13px;
      font-weight: 700;
      color: var(--primary-dark);
    }

    .bed-status-pill {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #eceff1;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .bed-status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--muted);
    }

    .bed-meta {
      font-size: 11px;
      color: #69809c;
      font-weight: 500;
    }

    /* Bed status colors */
    .status-free .bed-status-pill {
      background: rgba(46, 125, 50, 0.12);
      color: var(--success);
    }
    .status-free .bed-status-dot {
      background: var(--success);
    }

    .status-occupied .bed-status-pill {
      background: rgba(229, 57, 53, 0.12);
      color: var(--danger);
    }
    .status-occupied .bed-status-dot {
      background: var(--danger);
    }

    .status-discharge .bed-status-pill {
      background: rgba(255, 179, 0, 0.12);
      color: var(--warning);
    }
    .status-discharge .bed-status-dot {
      background: var(--warning);
    }

    .status-isolation .bed-status-pill {
      background: rgba(123, 31, 162, 0.12);
      color: var(--isolation);
    }
    .status-isolation .bed-status-dot {
      background: var(--isolation);
    }

    .status-outofservice .bed-status-pill {
      background: rgba(144, 164, 174, 0.2);
      color: var(--muted);
    }
    .status-outofservice .bed-status-dot {
      background: var(--muted);
    }

    .status-free .bed-body {
      background: linear-gradient(135deg, #d7f3e4, #f5fbf8);
      border: 1px solid rgba(46, 125, 50, 0.25);
    }
    .status-occupied .bed-body {
      background: linear-gradient(135deg, #ffe0e3, #fff3f4);
      border: 1px solid rgba(211, 47, 47, 0.25);
    }
    .status-discharge .bed-body {
      background: linear-gradient(135deg, #fff3d1, #fff8e6);
      border: 1px solid rgba(255, 179, 0, 0.3);
    }
    .status-isolation .bed-body {
      background: linear-gradient(135deg, #efd8ff, #f7edff);
      border: 1px solid rgba(123, 31, 162, 0.25);
    }
    .status-outofservice .bed-body {
      background: linear-gradient(135deg, #edf0f5, #f7f8fb);
      border: 1px solid rgba(144, 164, 174, 0.3);
    }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      font-size: 11px;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: #f7f9ff;
      border: 1px solid rgba(10, 56, 145, 0.08);
      font-weight: 500;
      font-size: 12px;
      transition: all 0.2s ease;
    }

    .legend-item:hover {
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(15, 37, 85, 0.1);
      transform: translateY(-1px);
    }

    .legend-dot {
      width: 11px;
      height: 11px;
      border-radius: 999px;
      background: var(--muted);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
    }

    .legend-dot.free {
      background: var(--success);
    }
    .legend-dot.occupied {
      background: var(--danger);
    }
    .legend-dot.discharge {
      background: var(--warning);
    }
    .legend-dot.isolation {
      background: var(--isolation);
    }
    .legend-dot.outofservice {
      background: var(--muted);
    }

    /* Details Panel */
    .details {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .details-section {
      border-radius: 16px;
      padding: 16px;
      background: linear-gradient(180deg, #ffffff, #f7f9fc);
      border: 1px solid rgba(10, 29, 65, 0.08);
      box-shadow: 0 4px 14px rgba(10, 29, 65, 0.08);
    }

    .details-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .details-label {
      color: #243A5A;
      font-size: 12px;
      font-weight: 600;
    }

    .details-value {
      font-weight: 700;
      color: #0A1D41;
      font-size: 14px;
    }

    /* ==== ØªØµÙ…ÙŠÙ… Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…Ø­Ø³Ù‘Ù† ==== */
    .ai-box {
      background: linear-gradient(180deg, #ffffff, #f8fbff);
      border: 1px solid rgba(10, 56, 145, 0.08);
      border-radius: 18px;
      padding: 22px;
      margin-top: 20px;
      box-shadow: 0 8px 22px rgba(15, 37, 85, 0.06);
    }

    .ai-title {
      font-size: 18px;
      font-weight: 700;
      color: #0b0e5b;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ai-section {
      margin-bottom: 18px;
      background: #f7f9ff;
      padding: 16px;
      border-radius: 14px;
      border: 1px solid rgba(10, 56, 145, 0.06);
    }

    .ai-section:last-child {
      margin-bottom: 0;
    }

    .ai-section-title {
      font-size: 13px;
      color: #0a56b3;
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .ai-score {
      display: inline-block;
      padding: 8px 14px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 700;
      background: rgba(39, 174, 96, 0.12);
      color: #27ae60;
    }

    .ai-score.medium {
      background: rgba(241, 196, 15, 0.18);
      color: #f39c12;
    }

    .ai-score.high {
      background: rgba(231, 76, 60, 0.18);
      color: #e74c3c;
    }

    .ai-reasons ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .ai-reasons li {
      margin-bottom: 8px;
      font-size: 13px;
      color: #4b5870;
      display: flex;
      gap: 8px;
      align-items: flex-start;
      line-height: 1.6;
    }

    .ai-reasons li:last-child {
      margin-bottom: 0;
    }

    .ai-badge {
      background: var(--bg-light);
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      color: var(--interactive);
      display: inline-block;
      margin: 4px 6px 4px 0;
      border: 1px solid var(--border-soft);
    }

    .ai-recommend-text {
      font-size: 13px;
      color: #37445a;
      line-height: 1.7;
      font-weight: 500;
    }

    .ai-empty-state {
      text-align: center;
      padding: 30px 20px;
      color: var(--muted);
    }

    .ai-empty-state-icon {
      font-size: 48px;
      margin-bottom: 12px;
      opacity: 0.5;
    }

    .ai-empty-state-text {
      font-size: 14px;
      font-weight: 500;
    }

    .btn-primary {
      width: 100%;
      border-radius: 30px;
      border: none;
      padding: 10px;
      background: var(--primary);
      color: #FFFFFF;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(10, 29, 65, 0.2);
      display: inline-flex;
      justify-content: center;
    }

    .btn-secondary {
      width: 100%;
      border-radius: 30px;
      border: 2px solid var(--primary);
      padding: 10px;
      background: transparent;
      color: var(--primary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
      display: inline-flex;
      justify-content: center;
      align-items: center;
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--bg-light);
      transform: translateY(-1px);
    }

    .btn-secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      backdrop-filter: blur(4px);
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: #fff;
      border-radius: 20px;
      padding: 28px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary-dark);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background: rgba(0, 0, 0, 0.05);
      color: var(--primary-dark);
    }

    .modal-field {
      margin-bottom: 18px;
    }

    .modal-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--primary-dark);
      margin-bottom: 6px;
    }

    .modal-input,
    .modal-select,
    .modal-textarea {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid rgba(10, 86, 179, 0.2);
      border-radius: 12px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
    }

    .modal-input:focus,
    .modal-select:focus,
    .modal-textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(10, 86, 179, 0.1);
    }

    .modal-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .modal-ai-check {
      background: #f7f9ff;
      border: 1px solid rgba(10, 86, 179, 0.1);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 18px;
    }

    .modal-ai-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .modal-ai-status.checking {
      color: var(--primary);
    }

    .modal-ai-status.success {
      color: #27ae60;
    }

    .modal-ai-status.error {
      color: #e74c3c;
    }

    .modal-ai-status.warning {
      color: #f39c12;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 24px;
    }

    .modal-btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: #fff;
    }

    .modal-btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(10, 86, 179, 0.3);
    }

    .modal-btn-secondary {
      background: #f5f7fb;
      color: var(--primary-dark);
      border: 1px solid rgba(10, 86, 179, 0.2);
    }

    .modal-btn-secondary:hover {
      background: #eef2fa;
    }

    .btn-primary:hover {
      box-shadow: 0 8px 22px rgba(10, 86, 179, 0.45);
      transform: translateY(-2px);
    }

    .btn-primary:active {
      transform: translateY(0px);
      box-shadow: 0 4px 12px rgba(10, 86, 179, 0.4);
    }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      font-size: 11px;
    }

    .chip-soft {
      padding: 4px 9px;
      border-radius: 999px;
      background: #edf3ff;
      color: var(--primary-dark);
      font-weight: 500;
      border: 1px solid rgba(10, 56, 145, 0.06);
      transition: all 0.2s ease;
    }

    .chip-soft:hover {
      background: #e0ebff;
      border-color: rgba(10, 86, 179, 0.12);
    }

    .muted {
      color: var(--muted);
    }

    /* ==== ØªØµÙ…ÙŠÙ… Ø§Ù„ØºØ±Ù ==== */
    .rooms-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      margin-top: 22px;
    }

    @media (max-width: 500px) {
      .rooms-grid {
        grid-template-columns: repeat(1, 1fr);
      }
    }

    .room-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      box-shadow: 0 10px 24px rgba(15, 37, 85, 0.08);
      transition: all 0.25s ease;
      position: relative;
      cursor: pointer;
    }

    .room-card:hover {
      transform: translateY(-3px);
      border-color: #0a56b3;
      box-shadow: 0 14px 30px rgba(15, 37, 85, 0.15);
    }

    .room-title {
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--primary-dark);
    }

    .room-bed {
      margin-top: 8px;
      padding: 12px;
      background: #f7f9ff;
      border-radius: 12px;
      border: 1px solid rgba(10, 56, 145, 0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .room-bed span {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary-dark);
    }

    /* Ø­Ø§Ù„Ø© Ø§Ù„ØºØ±ÙØ© */
    .room-status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 700;
      margin-top: 10px;
    }

    .room-status-clean {
      background: rgba(46, 204, 113, 0.15);
      color: #27ae60;
    }

    .room-status-isolation {
      background: rgba(155, 89, 182, 0.18);
      color: #8e44ad;
    }

    .room-status-busy {
      background: rgba(231, 76, 60, 0.18);
      color: #e74c3c;
    }

    .toggle-wrapper {
      display: inline-flex;
      padding: 3px;
      border-radius: 12px;
      background: #edf3ff;
      gap: 3px;
    }

    .toggle-btn {
      border-radius: 10px;
      padding: 4px 10px;
      font-size: 12px;
      border: none;
      background: transparent;
      cursor: pointer;
      color: var(--primary-dark);
      opacity: 0.6;
      transition: all 0.2s ease;
    }

    .toggle-btn.active {
      background: #ffffff;
      opacity: 1;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(10, 56, 145, 0.12);
    }

    .toggle-btn:hover {
      opacity: 1;
    }
  </style>
</head>
<body>
<div class="mobile-header">
  <span class="mobile-menu-btn" onclick="openMenu()">â˜°</span>
  <span>Smart Bed System</span>
</div>

<div id="mobileMenu" class="mobile-menu">
  <div class="mobile-menu-close" onclick="closeMenu()">Ã—</div>
  <a href="main_dashboard.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="smart_beds.html">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø±Ø©</a>
  <a href="control_panel.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  <a href="network_transfer.html">Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª</a>
  <a href="transfer_requests.html">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
</div>

<div class="app-shell">
  <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
  <header>
    <div class="header-left">
      <div class="logo-circle" aria-hidden="true"></div>
      <div class="header-title">
        <div class="header-title-main">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© â€“ Smart Bed Map</div>
        <div class="header-title-sub">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø±Ø© Ø¨Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²</div>
      </div>
    </div>
    <div class="header-actions">
      <a href="main_dashboard.html" class="nav-link">
        Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      </a>
      <a href="control_panel.html" class="nav-link">
         Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
      </a>
      <a href="network_transfer.html" class="nav-link">
          Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª
      </a>
      <a href="transfer_requests.html" class="nav-link">
          Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
      </a>
      <span class="tag-season">
         ÙˆØ¶Ø¹ Ø§Ù„Ù…ÙˆØ§Ø³Ù…
        <span id="seasonLabel">Ø¹Ø§Ø¯ÙŠ</span>
      </span>
      <button id="seasonToggle" class="season-toggle" type="button">
         ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø¬ / Ø±Ù…Ø¶Ø§Ù†
      </button>
      <div class="user-chip">
        <div class="user-avatar">HN</div>
        <span>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Head Nurse</span>
      </div>
    </div>
  </header>

  <!-- Season Banner -->
  <div id="seasonBanner" style="
    display:none;
    background:#fff3cd;
    padding:14px 20px;
    color:#664d03;
    border:1px solid #ffeeba;
    border-radius:12px;
    margin:12px 18px;
    font-size:14px;
    box-shadow:0 2px 6px rgba(0,0,0,0.06);
  ">
    <strong>ÙˆØ¶Ø¹ Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬ Ù…ÙØ¹Ù‘Ù„:</strong> ØªÙ… Ø±ÙØ¹ Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„ØŒ ÙˆØ®ÙØ¶ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¶ØºØ·ØŒ ÙˆØ¥Ø¹Ø·Ø§Ø¡ Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø© ÙˆØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©.
  </div>

  <main>
    <div class="layout">
      <!-- Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø§Ù„ÙŠÙ…Ù†Ù‰ (Ø§Ù„ÙÙ„ØªØ±) -->
      <aside class="card side-panel">
        <div class="card-header">
          <div>
            <div class="card-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¨Ù†Ù‰ / Ø§Ù„Ø¯ÙˆØ±</div>
            <div class="card-subtitle">Ø¹Ø±Ø¶ Ø£Ø³Ø±Ø© Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²</div>
          </div>
          <span class="badge-light">Real-time</span>
        </div>
        <div class="filters">
          <div>
            <div class="field-label">Ø§Ù„Ù…Ø¨Ù†Ù‰</div>
            <select id="buildingSelect">
              <option value="A">Ø§Ù„Ù…Ø¨Ù†Ù‰ A - Ø§Ù„ØªÙ†ÙˆÙŠÙ…</option>
              <option value="B">Ø§Ù„Ù…Ø¨Ù†Ù‰ B - Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²Ø©</option>
              <option value="C">Ø§Ù„Ù…Ø¨Ù†Ù‰ C - Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</option>
            </select>
          </div>

          <div>
            <div class="field-label">Ø§Ù„Ø¯ÙˆØ±</div>
            <select id="floorSelect">
              <option value="4">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø±Ø§Ø¨Ø¹ - Ø¨Ø§Ø·Ù†ÙŠØ©</option>
              <option value="3">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø«Ø§Ù„Ø« - Ø¬Ø±Ø§Ø­Ø©</option>
              <option value="2">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø¹Ø¸Ø§Ù…</option>
              <option value="1">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø£ÙˆÙ„ - Ø·ÙˆØ§Ø±Ø¦</option>
            </select>
          </div>

          <div style="margin-top: 6px;">
            <div class="field-label">Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø©</div>
            <div class="quick-stats" id="quickStats"></div>
          </div>
        </div>
      </aside>

      <!-- Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø±Ø© -->
      <section class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</div>
            <div class="card-subtitle">Ø¹Ø±Ø¶ Ø­ÙŠ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø±Ø© ÙÙŠ Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ù…Ø®ØªØ§Ø±</div>
          </div>
          <div class="toggle-wrapper">
            <button class="toggle-btn active" onclick="setView('ward')">Ø¹Ø±Ø¶ Ø¬Ù†Ø§Ø­</button>
            <button class="toggle-btn" onclick="setView('rooms')">Ø¹Ø±Ø¶ ØºØ±Ù</button>
          </div>
        </div>

        <div class="map-container">
          <div class="map-toolbar">
            <span class="muted" style="font-size: 12px;">
              ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø±ÙŠØ± Ø¢Ù„ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª Ø£Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨ÙŠ.
            </span>
          </div>

          <div class="map-wrapper">
            <div class="ward-label" id="wardLabel">Ø§Ù„Ø¬Ù†Ø§Ø­ 4B - Ø¨Ø§Ø·Ù†ÙŠØ© Ù†Ø³Ø§Ø¡</div>
            <div class="bed-grid" id="bedGrid">
              <!-- Ø§Ù„Ø£Ø³Ø±Ù‘Ø© Ù…Ù† JS -->
            </div>
            <!-- ==== Ø´Ø¨ÙƒØ© Ø§Ù„ØºØ±Ù (Ù…Ø®ÙÙŠØ© Ø¨Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©) ==== -->
            <div id="roomsGrid" class="rooms-grid" style="display:none;"></div>
          </div>

          <div class="legend">
            <div class="legend-item">
              <span class="legend-dot free"></span> Ù…ØªØ§Ø­
            </div>
            <div class="legend-item">
              <span class="legend-dot occupied"></span> Ù…Ø´ØºÙˆÙ„
            </div>
            <div class="legend-item">
              <span class="legend-dot discharge"></span> Ù‚Ø±ÙŠØ¨ Ø§Ù„Ø®Ø±ÙˆØ¬
            </div>
            <div class="legend-item">
              <span class="legend-dot isolation"></span> Ø¹Ø²Ù„
            </div>
            <div class="legend-item">
              <span class="legend-dot outofservice"></span> Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©
            </div>
          </div>
        </div>
      </section>

      <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ± -->
      <aside class="card details-panel">
        <div class="card-header">
          <div>
            <div class="card-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ±</div>
            <div class="card-subtitle">Ø§Ø®ØªÙØ± Ø³Ø±ÙŠØ±Ø§Ù‹ Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</div>
          </div>
        </div>

        <div class="details" id="detailsContainer">
          <div class="details-section">
            <div class="details-row">
              <span class="details-label">Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠØ±</span>
              <span class="details-value" id="detailBedId">â€”</span>
            </div>
            <div class="details-row">
              <span class="details-label">Ø§Ù„Ø­Ø§Ù„Ø©</span>
              <span class="details-value" id="detailStatus">â€”</span>
            </div>
            <div class="details-row">
              <span class="details-label">Ø§Ù„Ù…Ø±ÙŠØ¶</span>
              <span class="details-value" id="detailPatient">â€”</span>
            </div>
            <div class="details-row">
              <span class="details-label">Ù…ØªÙˆÙ‚Ø¹ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
              <span class="details-value" id="detailEta">â€”</span>
            </div>
            <div class="details-row">
              <span class="details-label">Ø§Ù„Ù…Ù…Ø±Ø¶ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</span>
              <span class="details-value" id="detailNurse">â€”</span>
            </div>
          </div>

          <button class="btn-secondary" type="button" id="sendTransferRequestBtn" disabled style="margin-top: 10px;">
            Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªØ­ÙˆÙŠÙ„ Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø¢Ø®Ø±
          </button>

          <button class="btn-secondary" type="button" id="internalTransferBtn" style="margin-top: 10px;">
            Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
          </button>

          <div class="chips-row">
            <span class="chip-soft">Ù†Ø³Ø¨Ø© ØªÙ…Ø±ÙŠØ¶/Ù…Ø±Ø¶Ù‰: <span id="nurseRatio">1 : 5</span></span>
            <span class="chip-soft">Ø¶ØºØ· Ø§Ù„Ø¬Ù†Ø§Ø­: <span id="wardLoad">Ù…Ø±ØªÙØ¹</span></span>
            <span class="chip-soft">ÙˆØ¶Ø¹ Ø§Ù„Ù…ÙˆØ§Ø³Ù…: <span id="seasonChip">Ø¹Ø§Ø¯ÙŠ</span></span>
          </div>
        </div>
      </aside>
    </div>

    <!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (ØªØ­Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø©) -->
    <div class="card ai-analysis-card">
      <div class="ai-box" id="aiBox">
        <div class="ai-empty-state">
          <div class="ai-empty-state-icon">ğŸ¤–</div>
          <div class="ai-empty-state-text">Ø§Ø®ØªØ± Ø³Ø±ÙŠØ±Ø§Ù‹ Ù„Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modal Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªØ­ÙˆÙŠÙ„ -->
<div class="modal-overlay" id="transferRequestModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªØ­ÙˆÙŠÙ„ Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø¢Ø®Ø±</div>
      <button class="modal-close" onclick="closeTransferModal()">&times;</button>
    </div>
    <form id="transferRequestForm">
      <div class="modal-field">
        <label class="modal-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</label>
        <input type="text" class="modal-input" id="modalPatientName" readonly>
      </div>
      <div class="modal-field">
        <label class="modal-label">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙŠØ¶</label>
        <input type="text" class="modal-input" id="modalPatientStatus" readonly>
      </div>
      <div class="modal-field">
        <label class="modal-label">Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</label>
        <select class="modal-select" id="modalTargetHospital" required>
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰</option>
          <option value="Ø§Ù„Ù†ÙˆØ±">Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù†ÙˆØ± Ø§Ù„ØªØ®ØµØµÙŠ</option>
          <option value="Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡">Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø·Ø¨ÙŠØ©</option>
          <option value="Ø­Ø±Ø§Ø¡">Ù…Ø³ØªØ´ÙÙ‰ Ø­Ø±Ø§Ø¡</option>
          <option value="Ø§Ù„ÙˆÙ„Ø§Ø¯Ø©">Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„ÙˆÙ„Ø§Ø¯Ø© ÙˆØ§Ù„Ø£Ø·ÙØ§Ù„</option>
        </select>
      </div>
      <div class="modal-field">
        <label class="modal-label">Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
        <textarea class="modal-textarea" id="modalTransferReason" placeholder="Ø§Ø°ÙƒØ± Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„..." required></textarea>
      </div>
      <div class="modal-field">
        <label class="modal-label">Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ (ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…Ù† AI)</label>
        <input type="text" class="modal-input" id="modalPriority" readonly>
      </div>
      <div class="modal-ai-check" id="modalAICheck">
        <div class="modal-ai-status checking">
          <span>ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø© ÙÙŠ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‡Ø¯Ù...</span>
        </div>
        <div id="modalAIResult" style="font-size: 12px; color: #666; margin-top: 6px;"></div>
      </div>
      <div class="modal-actions">
        <button type="button" class="modal-btn modal-btn-secondary" onclick="closeTransferModal()">Ø¥Ù„ØºØ§Ø¡</button>
        <button type="submit" class="modal-btn modal-btn-primary" id="modalSubmitBtn" disabled>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ -->
<div class="modal-overlay" id="internalTransferModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
      <button class="modal-close" onclick="closeInternalTransferModal()">&times;</button>
    </div>
    <form id="internalTransferForm">
      <div class="modal-field">
        <label class="modal-label">Ø§Ù„Ø³Ø±ÙŠØ±</label>
        <input type="text" class="modal-input" id="internalBedId" readonly>
      </div>
      <div class="modal-field">
        <label class="modal-label">Ø§Ù„Ù…Ø±ÙŠØ¶</label>
        <input type="text" class="modal-input" id="internalPatientName" readonly>
      </div>
      <div class="modal-field">
        <label class="modal-label">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
        <select class="modal-select" id="sourceWard" required>
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
          <option value="4B">Ø§Ù„Ø¬Ù†Ø§Ø­ 4B - Ø¨Ø§Ø·Ù†ÙŠØ© Ù†Ø³Ø§Ø¡</option>
          <option value="3B">Ø§Ù„Ø¬Ù†Ø§Ø­ 3B - Ø¬Ø±Ø§Ø­Ø©</option>
          <option value="2B">Ø§Ù„Ø¬Ù†Ø§Ø­ 2B - Ø¹Ø¸Ø§Ù…</option>
          <option value="1A">Ø§Ù„Ø¬Ù†Ø§Ø­ 1A - Ø·ÙˆØ§Ø±Ø¦</option>
          <option value="5C">Ø§Ù„Ø¬Ù†Ø§Ø­ 5C - Ù‚Ù„Ø¨</option>
          <option value="ICU">Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²Ø©</option>
        </select>
        <div id="sourceWardInfo" style="margin-top: 8px; font-size: 12px; color: #777;"></div>
      </div>
      <div class="modal-field">
        <label class="modal-label">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</label>
        <select class="modal-select" id="targetWard" required>
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
          <option value="4B">Ø§Ù„Ø¬Ù†Ø§Ø­ 4B - Ø¨Ø§Ø·Ù†ÙŠØ© Ù†Ø³Ø§Ø¡</option>
          <option value="3B">Ø§Ù„Ø¬Ù†Ø§Ø­ 3B - Ø¬Ø±Ø§Ø­Ø©</option>
          <option value="2B">Ø§Ù„Ø¬Ù†Ø§Ø­ 2B - Ø¹Ø¸Ø§Ù…</option>
          <option value="1A">Ø§Ù„Ø¬Ù†Ø§Ø­ 1A - Ø·ÙˆØ§Ø±Ø¦</option>
          <option value="5C">Ø§Ù„Ø¬Ù†Ø§Ø­ 5C - Ù‚Ù„Ø¨</option>
          <option value="ICU">Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²Ø©</option>
        </select>
        <div id="targetWardInfo" style="margin-top: 8px; font-size: 12px; color: #777;"></div>
      </div>
      <div class="modal-ai-check" id="internalAIBox" style="display: none;">
        <div class="modal-ai-status checking">
          <span>ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„...</span>
        </div>
        <div id="internalAIText" style="font-size: 12px; color: #666; margin-top: 6px;"></div>
      </div>
      <div class="modal-actions">
        <button type="button" class="modal-btn modal-btn-secondary" onclick="closeInternalTransferModal()">Ø¥Ù„ØºØ§Ø¡</button>
        <button type="submit" class="modal-btn modal-btn-primary" id="internalTransferSubmitBtn" disabled>Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­ÙˆÙŠÙ„</button>
      </div>
    </form>
  </div>
</div>

<script>
  // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø£Ø³ÙØ±Ù‘Ø© â€“ ØªÙ‚Ø¯Ø±ÙÙŠÙ† ØªØ±Ø¨Ø·ÙŠÙ‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ø§Ù„Ù€ API
  const beds = [
    { id: "B401", status: "free", patient: null, eta: null, nurse: "Ø­Ù†Ø§Ù† Ø§Ù„Ø³Ù„Ù…ÙŠ", triage: "LOW" },
    { id: "B402", status: "occupied", patient: "Ø³Ø¹Ø§Ø¯ Ø£Ø­Ù…Ø¯", eta: "Ø§Ù„ÙŠÙˆÙ… 23:30", nurse: "Ù„ÙŠØ§Ù† Ø§Ù„ØªØ±ÙƒÙŠ", triage: "MEDIUM" },
    { id: "B403", status: "occupied", patient: "ÙˆÙØ§Ø¡ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ", eta: "ØºØ¯Ø§Ù‹ 10:00", nurse: "Ø±ÙŠÙ… Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ", triage: "HIGH" },
    { id: "B404", status: "discharge", patient: "Ù†ÙˆØ±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ", eta: "Ø§Ù„ÙŠÙˆÙ… 18:00", nurse: "Ù†ÙˆÙ Ø§Ù„Ø­Ø³ÙŠÙ†", triage: "LOW" },
    { id: "B405", status: "isolation", patient: "Ø­Ø§Ù„Ø© Ø¹Ø²Ù„ 001", eta: "ØºÙŠØ± Ù…Ø­Ø¯Ø¯", nurse: "Ù†Ù‡Ù‰ Ø§Ù„Ø´Ù‡Ø±ÙŠ", triage: "HIGH" },
    { id: "B406", status: "free", patient: null, eta: null, nurse: "Ø­Ù†Ø§Ù† Ø§Ù„Ø³Ù„Ù…ÙŠ", triage: "LOW" },
    { id: "B407", status: "occupied", patient: "Ù…Ø´Ø§Ø¹Ù„ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ", eta: "Ø¨Ø¹Ø¯ 48 Ø³Ø§Ø¹Ø©", nurse: "Ù„ÙŠØ§Ù† Ø§Ù„ØªØ±ÙƒÙŠ", triage: "MEDIUM" },
    { id: "B408", status: "outofservice", patient: null, eta: null, nurse: "â€”", triage: "NA" },
    { id: "B409", status: "occupied", patient: "Ø­ØµØ© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ", eta: "Ø§Ù„ÙŠÙˆÙ… 21:00", nurse: "Ø±ÙŠÙ… Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ", triage: "HIGH" },
    { id: "B410", status: "discharge", patient: "Ù†Ø¬Ù„Ø§Ø¡ Ø§Ù„Ù‚Ø±Ù†ÙŠ", eta: "Ø§Ù„ÙŠÙˆÙ… 17:15", nurse: "Ù†ÙˆÙ Ø§Ù„Ø­Ø³ÙŠÙ†", triage: "MEDIUM" },
    { id: "B411", status: "free", patient: null, eta: null, nurse: "Ø­Ù†Ø§Ù† Ø§Ù„Ø³Ù„Ù…ÙŠ", triage: "LOW" },
    { id: "B412", status: "isolation", patient: "Ø­Ø§Ù„Ø© Ø¹Ø²Ù„ 002", eta: "ØºÙŠØ± Ù…Ø­Ø¯Ø¯", nurse: "Ù†Ù‡Ù‰ Ø§Ù„Ø´Ù‡Ø±ÙŠ", triage: "HIGH" },
  ];

  let selectedBedId = null;
  let seasonMode = false;

  const bedGrid = document.getElementById("bedGrid");
  const quickStatsContainer = document.getElementById("quickStats");

  const detailBedId = document.getElementById("detailBedId");
  const detailStatus = document.getElementById("detailStatus");
  const detailPatient = document.getElementById("detailPatient");
  const detailEta = document.getElementById("detailEta");
  const detailNurse = document.getElementById("detailNurse");

  const aiBox = document.getElementById("aiBox");

  const nurseRatio = document.getElementById("nurseRatio");
  const wardLoad = document.getElementById("wardLoad");
  const seasonChip = document.getElementById("seasonChip");
  const seasonToggle = document.getElementById("seasonToggle");
  const seasonLabel = document.getElementById("seasonLabel");

  function statusToArabic(status) {
    switch (status) {
      case "free": return "Ù…ØªØ§Ø­";
      case "occupied": return "Ù…Ø´ØºÙˆÙ„";
      case "discharge": return "Ù‚Ø±ÙŠØ¨ Ø§Ù„Ø®Ø±ÙˆØ¬";
      case "isolation": return "Ø¹Ø²Ù„";
      case "outofservice": return "Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©";
      default: return "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    }
  }

  function buildBedGrid() {
    bedGrid.innerHTML = "";

    beds.forEach(bed => {
      const div = document.createElement("div");
      div.className = `bed status-${bed.status}`;
      div.dataset.bedId = bed.id;

      const head = document.createElement("div");
      head.className = "bed-head";

      const body = document.createElement("div");
      body.className = "bed-body";

      const row1 = document.createElement("div");
      row1.className = "bed-row";

      const spanId = document.createElement("span");
      spanId.className = "bed-id";
      spanId.textContent = bed.id;

      const statusPill = document.createElement("span");
      statusPill.className = "bed-status-pill";

      const statusDot = document.createElement("span");
      statusDot.className = "bed-status-dot";

      const statusText = document.createElement("span");
      statusText.textContent = statusToArabic(bed.status);

      statusPill.appendChild(statusDot);
      statusPill.appendChild(statusText);
      row1.appendChild(spanId);
      row1.appendChild(statusPill);

      const row2 = document.createElement("div");
      row2.className = "bed-row";

      const meta = document.createElement("span");
      meta.className = "bed-meta";

      if (bed.patient) {
        meta.textContent = bed.patient;
      } else {
        meta.textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø±ÙŠØ¶";
      }

      const eta = document.createElement("span");
      eta.className = "bed-meta";
      eta.textContent = bed.eta ? bed.eta : "â€”";

      row2.appendChild(meta);
      row2.appendChild(eta);

      body.appendChild(row1);
      body.appendChild(row2);

      // ØªØºÙŠÙŠØ± Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø±Ø© ÙÙŠ Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬
      if (seasonMode) {
        if (bed.status === "free") {
          body.style.background = "linear-gradient(135deg,#e8f7ff,#f0fbff)";
        }
        if (bed.status === "discharge") {
          body.style.background = "linear-gradient(135deg,#fff2c9,#fff6dd)";
        }
        if (bed.status === "isolation") {
          body.style.background = "linear-gradient(135deg,#f1ddff,#f7eaff)";
        }
      }

      div.appendChild(head);
      div.appendChild(body);

      div.addEventListener("click", () => onBedClicked(bed.id));

      bedGrid.appendChild(div);
    });
  }

  function calculateQuickStats() {
    const stats = {
      free: 0,
      occupied: 0,
      discharge: 0,
      isolation: 0,
      outofservice: 0,
    };

    beds.forEach(b => {
      if (stats[b.status] !== undefined) {
        stats[b.status]++;
      }
    });

    quickStatsContainer.innerHTML = "";

    const statItems = [
      { label: "Ù…ØªØ§Ø­", key: "free" },
      { label: "Ù…Ø´ØºÙˆÙ„", key: "occupied" },
      { label: "Ù‚Ø±ÙŠØ¨ Ø§Ù„Ø®Ø±ÙˆØ¬", key: "discharge" },
      { label: "Ø¹Ø²Ù„", key: "isolation" },
      { label: "Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©", key: "outofservice" },
      { label: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø±Ø©", key: "total" },
    ];

    statItems.forEach(item => {
      const value = item.key === "total"
        ? beds.length
        : stats[item.key];

      const statDiv = document.createElement("div");
      statDiv.className = "stat-badge";

      const strong = document.createElement("strong");
      strong.textContent = value;

      const span = document.createElement("span");
      span.textContent = item.label;

      statDiv.appendChild(strong);
      statDiv.appendChild(span);

      quickStatsContainer.appendChild(statDiv);
    });

    // ØªØ­Ø¯ÙŠØ« Ø­Ù…Ù„ Ø§Ù„Ø¬Ù†Ø§Ø­ Ø¨Ø´ÙƒÙ„ Ø¨Ø³ÙŠØ· Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„
    const occupiedRatio = stats.occupied / beds.length;
    
    // ÙÙŠ Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬ Ù†Ø±ÙØ¹ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©: Ø£ÙŠ Ø¬Ù†Ø§Ø­ ÙÙˆÙ‚ 55% ÙŠØ¹ØªØ¨Ø± "Ù…Ø±ØªÙØ¹"
    let adjustedOccupiedRatio = occupiedRatio;
    if (seasonMode) {
      if (occupiedRatio >= 0.55) {
        adjustedOccupiedRatio = 0.8;
      } else if (occupiedRatio >= 0.35) {
        adjustedOccupiedRatio = 0.6;
      }
    }

    if (adjustedOccupiedRatio >= 0.8) {
      wardLoad.textContent = "Ø­Ø±Ø¬";
    } else if (adjustedOccupiedRatio >= 0.6) {
      wardLoad.textContent = "Ù…Ø±ØªÙØ¹";
    } else if (adjustedOccupiedRatio >= 0.3) {
      wardLoad.textContent = "Ù…ØªÙˆØ³Ø·";
    } else {
      wardLoad.textContent = "Ù…Ù†Ø®ÙØ¶";
    }
  }

  function onBedClicked(bedId) {
    selectedBedId = bedId;
    const bed = beds.find(b => b.id === bedId);
    if (!bed) return;

    // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø³Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯
    document.querySelectorAll(".bed").forEach(el => {
      el.classList.toggle("selected", el.dataset.bedId === bedId);
    });

    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„
    detailBedId.textContent = bed.id;
    detailStatus.textContent = statusToArabic(bed.status);
    detailPatient.textContent = bed.patient || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø±ÙŠØ¶ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø±ÙŠØ±";
    detailEta.textContent = bed.eta || "â€”";
    detailNurse.textContent = bed.nurse;

    // Ø¨Ù†Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ AI Ø§Ù„Ø¬Ø¯ÙŠØ¯
    buildAIAnalysis(bed);
    
    // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„
    const sendTransferRequestBtn = document.getElementById("sendTransferRequestBtn");
    sendTransferRequestBtn.disabled = !bed.patient || bed.status === "free";
  }

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØºØ±Ù (ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©)
  const rooms = [
    {
      room: "401",
      status: "clean",
      bed: "B401",
      bedStatus: "free",
      ward: "4B"
    },
    {
      room: "402",
      status: "busy",
      bed: "B402",
      bedStatus: "occupied",
      ward: "4B"
    },
    {
      room: "403",
      status: "isolation",
      bed: "B405",
      bedStatus: "isolation",
      ward: "4B"
    },
    {
      room: "404",
      status: "busy",
      bed: "B403",
      bedStatus: "occupied",
      ward: "4B"
    },
    {
      room: "405",
      status: "clean",
      bed: "B406",
      bedStatus: "free",
      ward: "4B"
    },
    {
      room: "406",
      status: "busy",
      bed: "B407",
      bedStatus: "occupied",
      ward: "4B"
    },
    {
      room: "407",
      status: "clean",
      bed: "B411",
      bedStatus: "free",
      ward: "4B"
    },
    {
      room: "408",
      status: "isolation",
      bed: "B412",
      bedStatus: "isolation",
      ward: "4B"
    }
  ];

  // Ø±Ø³Ù… Ø§Ù„ØºØ±Ù
  function loadRooms() {
    const grid = document.getElementById("roomsGrid");
    grid.innerHTML = "";

    rooms.forEach(r => {
      const card = document.createElement("div");
      card.className = "room-card";
      card.innerHTML = `
        <div class="room-title">ØºØ±ÙØ© ${r.room}</div>
        <div class="room-bed">
          <span>ğŸ› Ø³Ø±ÙŠØ± ${r.bed}</span>
          <span>${statusToArabic(r.bedStatus)}</span>
        </div>
        <span class="room-status room-status-${r.status}">
          ${getRoomStatusArabic(r.status)}
        </span>
      `;
      grid.appendChild(card);
    });
  }

  // Ù†Øµ Ø¹Ø±Ø¨ÙŠ Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØºØ±ÙØ©
  function getRoomStatusArabic(s) {
    return {
      clean: "Ù†Ø¸ÙŠÙØ©",
      busy: "Ù…Ø´ØºÙˆÙ„Ø©",
      isolation: "Ø¹Ø²Ù„"
    }[s] || s;
  }

  // Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
  function setView(type) {
    const wing = document.getElementById("bedGrid");
    const roomsGrid = document.getElementById("roomsGrid");
    const wardLabel = document.getElementById("wardLabel");
    const toggleBtns = document.querySelectorAll(".toggle-btn");

    toggleBtns.forEach(btn => btn.classList.remove("active"));

    if (type === "ward") {
      wing.style.display = "grid";
      roomsGrid.style.display = "none";
      wardLabel.textContent = "Ø§Ù„Ø¬Ù†Ø§Ø­ 4B - Ø¨Ø§Ø·Ù†ÙŠØ© Ù†Ø³Ø§Ø¡";
      toggleBtns[0].classList.add("active");
    } else {
      wing.style.display = "none";
      roomsGrid.style.display = "grid";
      wardLabel.textContent = "Ø¹Ø±Ø¶ Ø­Ø³Ø¨ Ø§Ù„ØºØ±Ù - Ø§Ù„Ø¬Ù†Ø§Ø­ 4B";
      loadRooms();
      toggleBtns[1].classList.add("active");
    }
  }

  function buildAIAnalysis(bed) {
    // ØªØ­Ø¯ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø¨ triage
    let aiData = {
      score: "LOW",
      scoreText: "LOW â€“ Ù…Ø³ØªÙ‚Ø±Ø©",
      scoreClass: "",
      reasons: [],
      indicators: {},
      recommendation: ""
    };

    switch (bed.triage) {
      case "HIGH":
        aiData.score = "HIGH";
        aiData.scoreText = "HIGH â€“ Ø­Ø§Ù„Ø© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·ÙˆØ±Ø©";
        aiData.scoreClass = "high";
        aiData.reasons = [
          "Ø§Ù„Ø­Ø§Ù„Ø© ØªØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø³ØªÙ…Ø±Ø© ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ù…ÙƒØ«ÙØ©",
          "Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙŠØ¹Ø§Ù†ÙŠ Ù…Ù† Ø¶ØºØ· Ø¹Ø§Ù„ÙŠ (Ù†Ø³Ø¨Ø© Ù…Ù…Ø±Ø¶/Ù…Ø±ÙŠØ¶ 1:7)",
          "ÙŠÙÙ†ØµØ­ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ± Ø®Ù„Ø§Ù„ 15 Ø¯Ù‚ÙŠÙ‚Ø©",
          "ØªÙ‚ÙŠÙŠÙ… Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ù†Ù‚Ù„ Ø­Ø§Ù„Ø© Ù…Ø³ØªÙ‚Ø±Ø© Ù„ÙØªØ­ Ø³Ø±ÙŠØ± Ø§Ø­ØªÙŠØ§Ø·ÙŠ"
        ];
        aiData.indicators = {
          wardPressure: "Ù…Ø±ØªÙØ¹",
          equipment: "ÙŠØ­ØªØ§Ø¬ Ø£Ø¬Ù‡Ø²Ø© Ù…ØªØ®ØµØµØ©",
          bedType: "Ø³Ø±ÙŠØ± Ø¹Ø²Ù„/Ø¹Ù†Ø§ÙŠØ©",
          nurseRatio: "Ù…Ø±ØªÙØ¹Ø© (1:7)",
          riskLevel: "Ø¹Ø§Ù„ÙŠ"
        };
        aiData.recommendation = "ÙŠÙˆØµÙ‰ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ± Ø®Ù„Ø§Ù„ 15 Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ù…Ø¹ ØªÙ‚ÙŠÙŠÙ… Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ù†Ù‚Ù„ Ø­Ø§Ù„Ø© Ù…Ø³ØªÙ‚Ø±Ø© Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø¬Ù†Ø§Ø­ Ù„ÙØªØ­ Ø³Ø±ÙŠØ± Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø­Ø§Ù„Ø© Ø­Ø±Ø¬Ø© Ø¬Ø¯ÙŠØ¯Ø©.";
        break;
      case "MEDIUM":
        aiData.score = "MEDIUM";
        aiData.scoreText = "MEDIUM â€“ Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø©";
        aiData.scoreClass = "medium";
        aiData.reasons = [
          "Ø§Ù„Ù…Ø±ÙŠØ¶Ø© ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ø§ÙÙŠ ÙˆØªØ­ØªØ§Ø¬ Ø±Ø¹Ø§ÙŠØ© Ø£Ù‚Ù„ ÙƒØ«Ø§ÙØ©",
          "ÙŠÙ…ÙƒÙ† Ù†Ù‚Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø¬Ù†Ø§Ø­ Ø£Ù‚Ù„ Ø¶ØºØ·Ø§Ù‹",
          "Ù„ØªØ­Ø±ÙŠØ± Ø³Ø±ÙŠØ± Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©",
          "Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¶ØºØ· (1:6)"
        ];
        aiData.indicators = {
          wardPressure: "Ù…ØªÙˆØ³Ø·",
          equipment: "Ù„Ø§ ÙŠØ­ØªØ§Ø¬",
          bedType: "Ø³Ø±ÙŠØ± Ø¹Ø§Ø¯ÙŠ",
          nurseRatio: "Ù…ØªÙˆØ³Ø·Ø© (1:6)",
          riskLevel: "Ù…ØªÙˆØ³Ø·"
        };
        aiData.recommendation = "ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø±ÙŠØ¶Ø© Ø¥Ù„Ù‰ Ø¬Ù†Ø§Ø­ Ø£Ù‚Ù„ Ø¶ØºØ·Ø§Ù‹ Ø®Ù„Ø§Ù„ Ø§Ù„Ø³Ø§Ø¹ØªÙŠÙ† Ø§Ù„Ù‚Ø§Ø¯Ù…ØªÙŠÙ†ØŒ Ù„Ø®ÙØ¶ Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ù…Ù„ Ø§Ù„ØªÙ…Ø±ÙŠØ¶ÙŠ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù†Ø§Ø­.";
        break;
      case "LOW":
        aiData.score = "LOW";
        aiData.scoreText = "LOW â€“ Ù…Ø³ØªÙ‚Ø±Ø©";
        aiData.scoreClass = "";
        aiData.reasons = [
          "Ø§Ù„Ø³Ø±ÙŠØ± Ù…Ù†Ø§Ø³Ø¨ Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±",
          "Ù„Ø§ ÙŠØ­ØªØ§Ø¬ Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…ÙƒØ«ÙØ©",
          "Ø§Ù„Ø¬Ù†Ø§Ø­ Ø®ÙÙŠÙ Ø§Ù„Ø¶ØºØ· (1:5)",
          "Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù†Ø¯ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¶ØºØ· ÙÙŠ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦"
        ];
        aiData.indicators = {
          wardPressure: "Ù…Ù†Ø®ÙØ¶",
          equipment: "Ù„Ø§ ÙŠØ­ØªØ§Ø¬",
          bedType: "Ø³Ø±ÙŠØ± Ø¹Ø§Ø¯ÙŠ",
          nurseRatio: "Ù…Ù†Ø®ÙØ¶Ø© (1:5)",
          riskLevel: "Ù…Ù†Ø®ÙØ¶"
        };
        aiData.recommendation = "Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„ØªØ­ÙˆÙŠÙ„ ÙÙˆØ±ÙŠ. ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø³Ø±ÙŠØ± Ø¶Ù…Ù† Ø®Ø·Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø¥Ø°Ø§ Ø²Ø§Ø¯ Ø§Ù„Ø¶ØºØ· ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦.";
        break;
      default:
        aiData.score = "NA";
        aiData.scoreText = "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
        aiData.reasons = ["Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„"];
        aiData.indicators = {
          wardPressure: "â€”",
          equipment: "â€”",
          bedType: "â€”",
          nurseRatio: "â€”",
          riskLevel: "â€”"
        };
        aiData.recommendation = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø©.";
    }

    // ØªØ·Ø¨ÙŠÙ‚ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ÙˆØ§Ø³Ù… - Ø±ÙØ¹ Ø­Ø³Ø§Ø³ÙŠØ© triage
    if (seasonMode) {
      // Ø±ÙØ¹ Ø­Ø³Ø§Ø³ÙŠØ© triage ÙÙŠ Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬
      if (aiData.score === "LOW") {
        // LOW ÙŠØµÙŠØ± Ø£Ù‚Ø±Ø¨ Ù„Ù€ MEDIUM
        aiData.score = "MEDIUM";
        aiData.scoreText = "MEDIUM â€“ Ù…ØªÙˆØ³Ø·Ø© (Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬: Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ø±ØªÙØ¹Ø©)";
        aiData.scoreClass = "medium";
        aiData.reasons.unshift("ÙÙŠ Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬: ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„ØªÙˆÙÙŠØ± Ø³Ø±ÙŠØ± Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø­Ø§Ù„Ø§Øª Ø­Ø±Ø¬Ø©");
      } else if (aiData.score === "MEDIUM") {
        // MEDIUM ÙŠØ¹Ø§Ù…Ù„ ÙƒÙ€ HIGH
        aiData.score = "HIGH";
        aiData.scoreText = "HIGH â€“ Ø¹Ø§Ù„ÙŠØ© (Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬: Ø£ÙˆÙ„ÙˆÙŠØ© Ù‚ØµÙˆÙ‰)";
        aiData.scoreClass = "high";
        aiData.reasons.unshift("ÙÙŠ Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬: ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰ - ÙŠÙÙØ¶Ù‘Ù„ Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ø³Ø±ÙŠØ± Ù‚Ø±ÙŠØ¨Ø§Ù‹");
      } else if (aiData.score === "HIGH") {
        // HIGH ÙŠØ¨Ù‚Ù‰ HIGH Ù„ÙƒÙ† Ø¨ØµÙŠØ§ØºØ© Ø­Ø¬
        aiData.scoreText = "HIGH â€“ Ø­Ø±Ø¬Ø© Ø¬Ø¯Ø§Ù‹ (Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬: Ø¥Ø®Ù„Ø§Ø¡ ÙÙˆØ±ÙŠ)";
        aiData.reasons.unshift("ÙÙŠ Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬: Ø­Ø§Ù„Ø© Ø­Ø±Ø¬Ø© Ø¬Ø¯Ø§Ù‹ - Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ø³Ø±ÙŠØ± ÙÙˆØ±Ø§Ù‹ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø­Ø¬Ø§Ø¬/Ù…Ø¹ØªÙ…Ø±ÙŠÙ†");
      }
      
      aiData.reasons.push("ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ÙˆØ§Ø³Ù…: Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰ Ù„ØªÙˆÙÙŠØ± Ø£Ø³Ø±Ù‘Ø© Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø­Ø¬Ø§Ø¬ Ø£Ùˆ Ù…Ø¹ØªÙ…Ø±ÙŠÙ†");
      aiData.recommendation += " (ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ÙˆØ§Ø³Ù…: Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰ Ù„ØªÙˆÙÙŠØ± Ø£Ø³Ø±Ù‘Ø© Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø­Ø¬Ø§Ø¬ Ø£Ùˆ Ù…Ø¹ØªÙ…Ø±ÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹).";
    }

    // Ø¨Ù†Ø§Ø¡ HTML
    const aiHTML = `
      <div class="ai-title">ğŸ¤– Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ</div>

      <!-- AI Score -->
      <div class="ai-section">
        <div class="ai-section-title">ğŸ”µ ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ø©:</div>
        <span class="ai-score ${aiData.scoreClass}">${aiData.scoreText}</span>
      </div>

      <!-- Reasons -->
      <div class="ai-section ai-reasons">
        <div class="ai-section-title">ğŸ’¡ Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªØ­Ù„ÙŠÙ„:</div>
        <ul>
          ${aiData.reasons.map(reason => `<li>âœ” ${reason}</li>`).join('')}
        </ul>
      </div>

      <!-- Indicators -->
      <div class="ai-section">
        <div class="ai-section-title">ğŸ“Š Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª:</div>
        <div class="ai-badge">ğŸ”¥ Ø¶ØºØ· Ø§Ù„Ø¬Ù†Ø§Ø­: ${aiData.indicators.wardPressure}</div>
        <div class="ai-badge">ğŸ§ª Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©: ${aiData.indicators.equipment}</div>
        <div class="ai-badge">ğŸ› Ù†ÙˆØ¹ Ø§Ù„Ø³Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨: ${aiData.indicators.bedType}</div>
        <div class="ai-badge">ğŸ§‘â€âš• Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ¶: ${aiData.indicators.nurseRatio}</div>
        <div class="ai-badge">ğŸš¨ Ø®Ø·Ø± Ø§Ù„ØªØ¯Ù‡ÙˆØ±: ${aiData.indicators.riskLevel}</div>
      </div>

      <!-- Final Recommendation -->
      <div class="ai-section">
        <div class="ai-section-title">âœ… Ø§Ù„Ø®Ù„Ø§ØµØ©:</div>
        <div class="ai-recommend-text">
          ${aiData.recommendation}
        </div>
      </div>
    `;

    aiBox.innerHTML = aiHTML;
  }

  function initPills() {
    // ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ù€ setView
  }

  function initSeasonToggle() {
    const seasonBanner = document.getElementById("seasonBanner");
    
    seasonToggle.addEventListener("click", () => {
      seasonMode = !seasonMode;
      seasonToggle.classList.toggle("active", seasonMode);
      seasonLabel.textContent = seasonMode ? "Ø­Ø¬ / Ø±Ù…Ø¶Ø§Ù†" : "Ø¹Ø§Ø¯ÙŠ";
      seasonChip.textContent = seasonMode ? "Ø­Ø¬ / Ø±Ù…Ø¶Ø§Ù†" : "Ø¹Ø§Ø¯ÙŠ";

      // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Banner
      if (seasonBanner) {
        seasonBanner.style.display = seasonMode ? "block" : "none";
      }

      if (seasonMode) {
        nurseRatio.textContent = "1 : 7";
      } else {
        nurseRatio.textContent = "1 : 5";
      }

      // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø£Ø³Ø±Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
      calculateQuickStats();
      buildBedGrid();
      
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø³Ø±ÙŠØ± Ù…Ø­Ø¯Ø¯ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ AI
      if (selectedBedId) {
        const bed = beds.find(b => b.id === selectedBedId);
        if (bed) {
          buildAIAnalysis(bed);
        }
      }
    });
  }

  function initTransferButton() {
    const sendTransferRequestBtn = document.getElementById("sendTransferRequestBtn");
    sendTransferRequestBtn.addEventListener("click", () => {
      if (!selectedBedId) return;
      openTransferModal();
    });
  }

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª (Ù„Ù„Ù…Ø­Ø§ÙƒØ§Ø©)
  const hospitalsData = {
    "Ø§Ù„Ù†ÙˆØ±": { load: 44, ratio: "1:4.8", hasCapacity: true, waitTime: 0 },
    "Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡": { load: 62, ratio: "1:5.2", hasCapacity: true, waitTime: 15 },
    "Ø­Ø±Ø§Ø¡": { load: 78, ratio: "1:6.8", hasCapacity: false, waitTime: 0 },
    "Ø§Ù„ÙˆÙ„Ø§Ø¯Ø©": { load: 55, ratio: "1:5.5", hasCapacity: true, waitTime: 20 }
  };

  function openTransferModal() {
    const bed = beds.find(b => b.id === selectedBedId);
    if (!bed || !bed.patient) {
      alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø³Ø±ÙŠØ± ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø±ÙŠØ¶");
      return;
    }

    const modal = document.getElementById("transferRequestModal");
    document.getElementById("modalPatientName").value = bed.patient;
    document.getElementById("modalPatientStatus").value = statusToArabic(bed.status);
    document.getElementById("modalPriority").value = bed.triage === "HIGH" ? "Ø¹Ø§Ù„ÙŠØ©" : bed.triage === "MEDIUM" ? "Ù…ØªÙˆØ³Ø·Ø©" : "Ù…Ù†Ø®ÙØ¶Ø©";
    
    modal.classList.add("active");
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
    document.getElementById("modalTargetHospital").value = "";
    document.getElementById("modalTransferReason").value = "";
    document.getElementById("modalSubmitBtn").disabled = true;
    checkAICapacity();
  }

  function closeTransferModal() {
    const modal = document.getElementById("transferRequestModal");
    modal.classList.remove("active");
  }

  function checkAICapacity() {
    const hospitalSelect = document.getElementById("modalTargetHospital");
    const aiStatus = document.querySelector("#modalAICheck .modal-ai-status");
    const aiResult = document.getElementById("modalAIResult");
    const submitBtn = document.getElementById("modalSubmitBtn");
    
    hospitalSelect.addEventListener("change", () => {
      const selectedHospital = hospitalSelect.value;
      if (!selectedHospital) {
        aiStatus.className = "modal-ai-status checking";
        aiStatus.innerHTML = "<span>ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø© ÙÙŠ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‡Ø¯Ù...</span>";
        aiResult.textContent = "";
        submitBtn.disabled = true;
        return;
      }

      const hospital = hospitalsData[selectedHospital];
      const bed = beds.find(b => b.id === selectedBedId);
      
      // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† AI
      setTimeout(() => {
        if (hospital.hasCapacity) {
          if (hospital.waitTime === 0) {
            aiStatus.className = "modal-ai-status success";
            aiStatus.innerHTML = "<span>âœ” ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ â€” ÙŠÙˆØ¬Ø¯ Ø§Ø­ØªÙ…Ø§Ù„ Ù‚Ø¨ÙˆÙ„</span>";
            aiResult.textContent = "Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø£Ù† Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ù„Ø¯ÙŠÙ‡ Ø³Ø¹Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø­Ø§Ù„Ø©.";
            submitBtn.disabled = false;
          } else {
            aiStatus.className = "modal-ai-status warning";
            aiStatus.innerHTML = `<span>âš  Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù…ÙƒÙ† Ù„ÙƒÙ† ÙÙŠÙ‡ Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù…Ø¯Ø© ${hospital.waitTime} Ø¯Ù‚ÙŠÙ‚Ø©</span>`;
            aiResult.textContent = `Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ù„Ø¯ÙŠÙ‡ Ø³Ø¹Ø© Ù„ÙƒÙ† Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ${hospital.waitTime} Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø±ÙŠØ±.`;
            submitBtn.disabled = false;
          }
        } else {
          aiStatus.className = "modal-ai-status error";
          aiStatus.innerHTML = "<span>âŒ Ø§Ù„ØªØ­ÙˆÙŠÙ„ ØºÙŠØ± Ù…Ù…ÙƒÙ† â€” Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¹Ø© Ù…Ù†Ø§Ø³Ø¨Ø©</span>";
          aiResult.textContent = "Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ ÙŠØ¹Ø§Ù†ÙŠ Ù…Ù† Ø¶ØºØ· Ø¹Ø§Ù„ÙŠ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø­Ø§Ù„Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ.";
          submitBtn.disabled = true;
        }
      }, 1000);
    });
  }

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
  document.getElementById("transferRequestForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const hospital = document.getElementById("modalTargetHospital").value;
    const reason = document.getElementById("modalTransferReason").value;
    const bed = beds.find(b => b.id === selectedBedId);
    
    alert(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!\n\nØ§Ù„Ù…Ø±ÙŠØ¶: ${bed.patient}\nØ§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„: ${hospital}\nØ³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„: ${reason}`);
    closeTransferModal();
  });

  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø± Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø³Ø±ÙŠØ±
  const originalOnBedClicked = onBedClicked;
  onBedClicked = function(bedId) {
    originalOnBedClicked(bedId);
    const bed = beds.find(b => b.id === bedId);
    const sendTransferRequestBtn = document.getElementById("sendTransferRequestBtn");
    sendTransferRequestBtn.disabled = !bed || !bed.patient || bed.status === "free";
  };

  /* ============================================================
    Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
  ============================================================ */
  const wardsData = {
    "4B": { name: "Ø§Ù„Ø¬Ù†Ø§Ø­ 4B - Ø¨Ø§Ø·Ù†ÙŠØ© Ù†Ø³Ø§Ø¡", load: 85, ratio: "1:6.5", availableBeds: 3, totalBeds: 20 },
    "3B": { name: "Ø§Ù„Ø¬Ù†Ø§Ø­ 3B - Ø¬Ø±Ø§Ø­Ø©", load: 72, ratio: "1:5.8", availableBeds: 5, totalBeds: 18 },
    "2B": { name: "Ø§Ù„Ø¬Ù†Ø§Ø­ 2B - Ø¹Ø¸Ø§Ù…", load: 65, ratio: "1:5.2", availableBeds: 7, totalBeds: 20 },
    "1A": { name: "Ø§Ù„Ø¬Ù†Ø§Ø­ 1A - Ø·ÙˆØ§Ø±Ø¦", load: 90, ratio: "1:7.2", availableBeds: 2, totalBeds: 20 },
    "5C": { name: "Ø§Ù„Ø¬Ù†Ø§Ø­ 5C - Ù‚Ù„Ø¨", load: 58, ratio: "1:4.5", availableBeds: 8, totalBeds: 19 },
    "ICU": { name: "Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²Ø©", load: 78, ratio: "1:2.5", availableBeds: 4, totalBeds: 18 }
  };

  function updateWardInfo(selectId, infoId) {
    const select = document.getElementById(selectId);
    const info = document.getElementById(infoId);
    
    select.addEventListener("change", () => {
      const wardId = select.value;
      if (wardId && wardsData[wardId]) {
        const ward = wardsData[wardId];
        info.innerHTML = `
          <div><strong>Ø§Ù„Ø¶ØºØ·:</strong> ${ward.load}%</div>
          <div><strong>Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ¶:</strong> ${ward.ratio}</div>
          <div><strong>Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…ØªØ§Ø­Ø©:</strong> ${ward.availableBeds}</div>
        `;
      } else {
        info.innerHTML = "";
      }
      
      checkInternalTransfer();
    });
  }

  function checkInternalTransfer() {
    const sourceWard = document.getElementById("sourceWard").value;
    const targetWard = document.getElementById("targetWard").value;
    const internalAIBox = document.getElementById("internalAIBox");
    const internalAIText = document.getElementById("internalAIText");
    const internalTransferSubmitBtn = document.getElementById("internalTransferSubmitBtn");
    const aiStatus = document.querySelector("#internalAIBox .modal-ai-status");
    
    if (!sourceWard || !targetWard || sourceWard === targetWard) {
      internalAIBox.style.display = "none";
      internalTransferSubmitBtn.disabled = true;
      return;
    }
    
    const source = wardsData[sourceWard];
    const target = wardsData[targetWard];
    
    if (!source || !target) return;
    
    internalAIBox.style.display = "block";
    
    // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† AI
    setTimeout(() => {
      // Ù…Ù†Ø·Ù‚ AI Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ
      let recommendation = "";
      let canTransfer = false;
      
      if (target.load > 85) {
        aiStatus.className = "modal-ai-status error";
        recommendation = `âš  Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ (${target.name}) ÙŠØ¹Ø§Ù†ÙŠ Ù…Ù† Ø¶ØºØ· Ø¹Ø§Ù„ÙŠ (${target.load}%). ÙŠÙÙ†ØµØ­ Ø¨Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø³Ù… Ø¢Ø®Ø±.`;
        canTransfer = false;
      } else if (target.availableBeds === 0) {
        aiStatus.className = "modal-ai-status error";
        recommendation = `âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø±Ø© Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ (${target.name}).`;
        canTransfer = false;
      } else if (target.load < source.load && target.availableBeds >= 2) {
        aiStatus.className = "modal-ai-status success";
        recommendation = `âœ” Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…ÙˆØµÙ‰ Ø¨Ù‡. Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ (${target.name}) Ù„Ø¯ÙŠÙ‡ Ø¶ØºØ· Ø£Ù‚Ù„ (${target.load}% Ù…Ù‚Ø§Ø¨Ù„ ${source.load}%) ÙˆØ£Ø³Ø±Ø© Ù…ØªØ§Ø­Ø© (${target.availableBeds} Ø³Ø±ÙŠØ±).`;
        canTransfer = true;
      } else if (target.availableBeds >= 1) {
        aiStatus.className = "modal-ai-status warning";
        recommendation = `âœ“ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù…ÙƒÙ†. Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ (${target.name}) Ù„Ø¯ÙŠÙ‡ ${target.availableBeds} Ø³Ø±ÙŠØ± Ù…ØªØ§Ø­.`;
        canTransfer = true;
      } else {
        aiStatus.className = "modal-ai-status warning";
        recommendation = `âš  Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ (${target.name}) Ù„Ø¯ÙŠÙ‡ Ø³Ø¹Ø© Ù…Ø­Ø¯ÙˆØ¯Ø©. ÙŠÙÙ†ØµØ­ Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø®Ø±Ù‰.`;
        canTransfer = false;
      }
      
      internalAIText.textContent = recommendation;
      internalTransferSubmitBtn.disabled = !canTransfer;
    }, 500);
  }

  function openInternalTransferModal() {
    const modal = document.getElementById("internalTransferModal");
    const bed = selectedBedId ? beds.find(b => b.id === selectedBedId) : null;
    
    if (bed) {
      document.getElementById("internalBedId").value = bed.id;
      document.getElementById("internalPatientName").value = bed.patient || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø±ÙŠØ¶";
    } else {
      document.getElementById("internalBedId").value = "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø³Ø±ÙŠØ± Ø£ÙˆÙ„Ø§Ù‹";
      document.getElementById("internalPatientName").value = "â€”";
    }
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
    document.getElementById("sourceWard").value = "";
    document.getElementById("targetWard").value = "";
    document.getElementById("sourceWardInfo").innerHTML = "";
    document.getElementById("targetWardInfo").innerHTML = "";
    document.getElementById("internalAIBox").style.display = "none";
    document.getElementById("internalTransferSubmitBtn").disabled = true;
    
    modal.classList.add("active");
    checkInternalTransfer();
  }

  function closeInternalTransferModal() {
    const modal = document.getElementById("internalTransferModal");
    modal.classList.remove("active");
  }

  function initInternalTransfer() {
    const internalTransferBtn = document.getElementById("internalTransferBtn");
    internalTransferBtn.addEventListener("click", () => {
      openInternalTransferModal();
    });

    updateWardInfo("sourceWard", "sourceWardInfo");
    updateWardInfo("targetWard", "targetWardInfo");
    
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById("internalTransferForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const sourceWard = document.getElementById("sourceWard").value;
      const targetWard = document.getElementById("targetWard").value;
      const source = wardsData[sourceWard];
      const target = wardsData[targetWard];
      const bed = selectedBedId ? beds.find(b => b.id === selectedBedId) : null;
      
      if (!source || !target) return;
      
      if (bed) {
        if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„Ø³Ø±ÙŠØ± ${bed.id} Ù…Ù† ${source.name} Ø¥Ù„Ù‰ ${target.name}ØŸ`)) {
          alert(`ØªÙ… Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ\nØ§Ù„Ø³Ø±ÙŠØ±: ${bed.id}\nØ§Ù„Ù…Ø±ÙŠØ¶: ${bed.patient || "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}\nÙ…Ù†: ${source.name}\nØ¥Ù„Ù‰: ${target.name}\n\nØ³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù‚Ø³Ù…ÙŠÙ† Ø¨Ø§Ù„ØªØ­ÙˆÙŠÙ„.`);
          closeInternalTransferModal();
        }
      } else {
        if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù…Ù† ${source.name} Ø¥Ù„Ù‰ ${target.name}ØŸ`)) {
          alert(`ØªÙ… Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ\nÙ…Ù†: ${source.name}\nØ¥Ù„Ù‰: ${target.name}\n\nÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ­ÙˆÙŠÙ„Ù‡.`);
          closeInternalTransferModal();
        }
      }
    });
  }

  function init() {
    buildBedGrid();
    calculateQuickStats();
    initPills();
    initSeasonToggle();
    initTransferButton();
    initInternalTransfer();
  }

  document.addEventListener("DOMContentLoaded", init);
</script>

<script>
  function openMenu() {
    const menu = document.getElementById("mobileMenu");
    if (menu) {
      menu.style.display = "block";
    }
  }

  function closeMenu() {
    const menu = document.getElementById("mobileMenu");
    if (menu) {
      menu.style.display = "none";
    }
  }
</script>
</body>
</html>

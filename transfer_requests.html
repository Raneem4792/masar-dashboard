<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    * {margin:0; padding:0; box-sizing:border-box;}
    body {
      font-family: "Tajawal", sans-serif;
      background: #F7F9FD;
      color:#1A3A7A;
      padding-bottom:50px;
    }
    header {
      background: #0A1D41;
      color:#FFFFFF;
      letter-spacing: 0.5px;
      padding:20px 30px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 4px 18px rgba(0,0,0,0.15);
    }
    .header-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .nav-link {
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      padding: 9px 18px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.12);
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .nav-link:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
    }

    .mobile-header {
      display: none;
      background: #0A1D41;
      color: #ffffff;
      padding: 14px 20px;
      font-size: 18px;
      font-weight: 700;
      align-items: center;
      justify-content: space-between;
    }

    .mobile-menu-btn {
      font-size: 26px;
      cursor: pointer;
    }

    .mobile-menu {
      display: none;
      position: fixed;
      inset-inline-start: 0;
      top: 0;
      height: 100vh;
      width: 260px;
      background: #0A1D41;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      z-index: 9999;
      overflow-y: auto;
    }

    .mobile-menu a {
      display: block;
      color: #ffffff;
      padding: 14px 0;
      font-size: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      text-decoration: none;
    }

    .mobile-menu-close {
      color: #ffffff;
      font-size: 26px;
      text-align: end;
      cursor: pointer;
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      header {
        flex-direction: column;
        gap: 12px;
        text-align: center;
      }

      .header-actions {
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
      }
    }

    @media (max-width: 768px) {
      header,
      .top-buttons {
        display: none !important;
      }

      .mobile-header {
        display: flex !important;
      }
    }
    .container {max-width:1400px; margin:40px auto; padding:0 20px;}

    /* Cards */
    .card {
      background:#fff;
      border-radius:20px;
      padding:24px;
      border:1px solid rgba(10,29,65,0.08);
      box-shadow:0 8px 24px rgba(10,29,65,0.08);
      margin-bottom:30px;
      width: 100%;
    }
    .incoming-card {border-top:5px solid #0A1D41;}
    .outgoing-card {border-top:5px solid #A8AD63;}
    .card-title {
      font-size:20px;
      font-weight:700;
      margin-bottom:20px;
      color:#A8AD63;
    }

    /* Request Cards */
    .request-card {
      background:linear-gradient(180deg, #ffffff, #f7f9fc);
      padding:20px;
      border-radius:18px;
      border:1px solid rgba(195, 199, 115, 0.4);
      box-shadow:0 6px 20px rgba(10, 29, 65, 0.08);
      margin-bottom:16px;
      transition:.25s;
    }
    .request-card:hover {
      transform:translateY(-2px);
      box-shadow:0 12px 28px rgba(10,29,65,0.12);
      border-color:#8A8F40;
    }

    .request-header {
      display:flex;
      justify-content:space-between;
      align-items:start;
      margin-bottom:12px;
    }

    .request-title {
      font-size:17px;
      font-weight:700;
      margin-bottom:4px;
      color:#0A1D41;
    }

    .request-meta {
      font-size:13px;
      color:#15294E;
    }

    .severity-badge {
      padding:6px 12px;
      border-radius:8px;
      font-size:12px;
      font-weight:600;
    }

    .severity-high {
      background:rgba(231,76,60,0.15);
      color:#e74c3c;
    }

    .severity-medium {
      background:rgba(241,196,15,0.15);
      color:#f39c12;
    }

    .severity-low {
      background:rgba(46,204,113,0.15);
      color:#27ae60;
    }

    .ai-recommendation {
      background:linear-gradient(180deg,#ffffff,#f7f9fc);
      padding:12px;
      border-radius:12px;
      margin-bottom:12px;
      border:1px solid rgba(195, 199, 115, 0.4);
    }

    .ai-recommendation-title {
      font-size:13px;
      font-weight:600;
      color:#1A3A7A;
      margin-bottom:6px;
    }

    .ai-recommendation-text {
      font-size:12px;
      color:#1A3A7A;
      line-height:1.6;
    }

    .request-actions {
      display:flex;
      gap:8px;
    }

    .btn-action {
      flex:1;
      padding:10px 14px;
      border:none;
      border-radius:12px;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
      transition:.2s;
    }

    .btn-accept {
      background:linear-gradient(135deg,#27ae60,#2ecc71);
      color:#fff;
    }

    .btn-accept:hover:not(:disabled) {
      transform:translateY(-2px);
      box-shadow:0 4px 12px rgba(46,204,113,0.3);
    }

    .btn-reject {
      background:linear-gradient(135deg,#e74c3c,#c0392b);
      color:#fff;
    }

    .btn-reject:hover {
      transform:translateY(-2px);
      box-shadow:0 4px 12px rgba(231,76,60,0.3);
    }

    .btn-details {
      background:#1A3A7A;
      color:#fff;
    }

    .btn-details:hover {
      transform:translateY(-2px);
    }

    .btn-action:disabled {
      opacity:0.5;
      cursor:not-allowed;
    }

    .empty-state {
      text-align:center;
      padding:40px 20px;
      color:#777;
    }

    .empty-state-icon {
      font-size:48px;
      margin-bottom:12px;
      opacity:0.5;
    }

    /* Verification Section */
    .verification-section {
      display: none;
      margin-top: 16px;
      padding: 16px;
      background: rgba(10, 29, 65, 0.05);
      border-radius: 12px;
      border: 1px solid rgba(10, 29, 65, 0.15);
    }

    .verification-section.active {
      display: block;
    }

    .verification-title {
      font-size: 14px;
      font-weight: 600;
      color: #0A1D41;
      margin-bottom: 12px;
    }

    .verification-input-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .verification-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid rgba(10, 29, 65, 0.2);
      border-radius: 10px;
      font-size: 15px;
      text-align: center;
      letter-spacing: 3px;
      font-family: monospace;
      transition: all 0.3s;
    }

    .verification-input:focus {
      outline: none;
      border-color: #0A1D41;
      box-shadow: 0 0 0 3px rgba(10, 29, 65, 0.1);
    }

    .verification-error {
      color: #e74c3c;
      font-size: 12px;
      margin-top: 8px;
      min-height: 18px;
    }

    .btn-verify {
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
      white-space: nowrap;
    }

    .btn-verify-confirm {
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: #fff;
    }

    .btn-verify-confirm:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
    }

    .btn-verify-cancel {
      background: #f0f0f0;
      color: #666;
      padding: 12px 16px;
    }

    .btn-verify-cancel:hover {
      background: #e0e0e0;
    }

    /* Action Modals */
    .action-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }

    .action-modal.active {
      display: flex;
    }

    .action-modal-content {
      background: #ffffff;
      border-radius: 20px;
      padding: 32px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
      position: relative;
    }

    .action-modal-close {
      position: absolute;
      top: 16px;
      left: 16px;
      font-size: 28px;
      color: #999;
      cursor: pointer;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: 0.2s;
    }

    .action-modal-close:hover {
      background: #f0f0f0;
      color: #666;
    }

    .action-modal-icon {
      font-size: 48px;
      margin-bottom: 16px;
      text-align: center;
    }

    .action-modal-title {
      font-size: 22px;
      font-weight: 700;
      color: #0A1D41;
      margin-bottom: 12px;
      text-align: center;
    }

    .action-modal-message {
      font-size: 15px;
      color: #555;
      margin-bottom: 24px;
      line-height: 1.6;
      text-align: center;
    }

    .action-modal-details {
      background: rgba(10, 29, 65, 0.05);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .action-modal-detail-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid rgba(10, 29, 65, 0.1);
    }

    .action-modal-detail-row:last-child {
      border-bottom: none;
    }

    .action-modal-detail-label {
      font-weight: 600;
      color: #1A3A7A;
      font-size: 14px;
    }

    .action-modal-detail-value {
      color: #555;
      font-size: 14px;
      text-align: left;
    }

    .action-modal-buttons {
      display: flex;
      gap: 12px;
    }

    .action-modal-btn {
      flex: 1;
      padding: 14px 24px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }

    .action-modal-btn-primary {
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: #fff;
    }

    .action-modal-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
    }

    .action-modal-btn-danger {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: #fff;
    }

    .action-modal-btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
    }

    .action-modal-btn-secondary {
      background: #f0f0f0;
      color: #666;
    }

    .action-modal-btn-secondary:hover {
      background: #e0e0e0;
    }

    /* Page Access Protection */
    .access-protection {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0A1D41, #1A3A7A);
      z-index: 99999;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .access-protection.hidden {
      display: none;
    }

    .access-content {
      background: #ffffff;
      border-radius: 24px;
      padding: 48px 40px;
      max-width: 450px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      text-align: center;
    }

    .access-lock-icon {
      font-size: 64px;
      margin-bottom: 24px;
      color: #0A1D41;
    }

    .access-title {
      font-size: 26px;
      font-weight: 700;
      color: #0A1D41;
      margin-bottom: 12px;
    }

    .access-subtitle {
      font-size: 15px;
      color: #666;
      margin-bottom: 32px;
      line-height: 1.6;
    }

    .access-input {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid rgba(10, 29, 65, 0.2);
      border-radius: 14px;
      font-size: 18px;
      margin-bottom: 16px;
      text-align: center;
      letter-spacing: 4px;
      font-family: monospace;
      transition: all 0.3s;
      box-sizing: border-box;
    }

    .access-input:focus {
      outline: none;
      border-color: #0A1D41;
      box-shadow: 0 0 0 4px rgba(10, 29, 65, 0.1);
    }

    .access-error {
      color: #e74c3c;
      font-size: 14px;
      margin-bottom: 20px;
      min-height: 22px;
      font-weight: 500;
    }

    .access-button {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
      background: linear-gradient(135deg, #0A1D41, #1A3A7A);
      color: #fff;
    }

    .access-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(10, 29, 65, 0.3);
    }

    .access-button:active {
      transform: translateY(0);
    }

    .access-back-button {
      width: 100%;
      padding: 14px;
      border: 2px solid rgba(10, 29, 65, 0.3);
      border-radius: 14px;
      background: #f0f0f0;
      color: #666;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
      text-decoration: none;
      display: block;
      text-align: center;
      margin-top: 12px;
    }

    .access-back-button:hover {
      background: #e0e0e0;
      border-color: rgba(10, 29, 65, 0.4);
      transform: translateY(-1px);
    }
  </style>
</head>

<body>

<!-- Accept Request Modal -->
<div id="acceptModal" class="action-modal" onclick="if(event.target === this) closeAcceptModal()">
  <div class="action-modal-content">
    <div class="action-modal-close" onclick="closeAcceptModal()">Ã—</div>
    <div class="action-modal-icon" style="color: #27ae60;">âœ“</div>
    <div class="action-modal-title">Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„</div>
    <div class="action-modal-message" id="acceptModalMessage"></div>
    <div class="action-modal-details" id="acceptModalDetails"></div>
    <div class="action-modal-buttons">
      <button class="action-modal-btn action-modal-btn-secondary" onclick="closeAcceptModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="action-modal-btn action-modal-btn-primary" onclick="confirmAccept()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‚Ø¨ÙˆÙ„</button>
    </div>
  </div>
</div>

<!-- Reject Request Modal -->
<div id="rejectModal" class="action-modal" onclick="if(event.target === this) closeRejectModal()">
  <div class="action-modal-content">
    <div class="action-modal-close" onclick="closeRejectModal()">Ã—</div>
    <div class="action-modal-icon" style="color: #e74c3c;">âœ—</div>
    <div class="action-modal-title">Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„</div>
    <div class="action-modal-message" id="rejectModalMessage"></div>
    <div class="action-modal-details" id="rejectModalDetails"></div>
    <div class="action-modal-buttons">
      <button class="action-modal-btn action-modal-btn-secondary" onclick="closeRejectModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="action-modal-btn action-modal-btn-danger" onclick="confirmReject()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¶</button>
    </div>
  </div>
</div>

<!-- Patient Details Modal -->
<div id="detailsModal" class="action-modal" onclick="if(event.target === this) closeDetailsModal()">
  <div class="action-modal-content">
    <div class="action-modal-close" onclick="closeDetailsModal()">Ã—</div>
    <div class="action-modal-icon" style="color: #0A1D41;">â„¹</div>
    <div class="action-modal-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</div>
    <div class="action-modal-details" id="detailsModalContent"></div>
    <div class="action-modal-buttons">
      <button class="action-modal-btn action-modal-btn-primary" onclick="closeDetailsModal()" style="flex: 1;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>
</div>

<!-- Cancel Request Modal -->
<div id="cancelModal" class="action-modal" onclick="if(event.target === this) closeCancelModal()">
  <div class="action-modal-content">
    <div class="action-modal-close" onclick="closeCancelModal()">Ã—</div>
    <div class="action-modal-icon" style="color: #f39c12;">âš </div>
    <div class="action-modal-title">Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„</div>
    <div class="action-modal-message" id="cancelModalMessage"></div>
    <div class="action-modal-details" id="cancelModalDetails"></div>
    <div class="action-modal-buttons">
      <button class="action-modal-btn action-modal-btn-secondary" onclick="closeCancelModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="action-modal-btn action-modal-btn-danger" onclick="confirmCancel()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<!-- Page Access Protection -->
<div id="accessProtection" class="access-protection">
  <div class="access-content">
    <div class="access-lock-icon">ğŸ”’</div>
    <div class="access-title">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</div>
    <div class="access-subtitle">Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ù…ÙŠØ©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„.</div>
    <input type="password" id="accessCode" class="access-input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ (6 Ø£Ø±Ù‚Ø§Ù…)" maxlength="6" autocomplete="off" onkeypress="if(event.key === 'Enter') checkAccess()">
    <div id="accessError" class="access-error"></div>
    <button class="access-button" onclick="checkAccess()">Ø¯Ø®ÙˆÙ„</button>
    <a href="main_dashboard.html" class="access-back-button">Ø±Ø¬ÙˆØ¹</a>
  </div>
</div>

<div class="mobile-header">
  <span class="mobile-menu-btn" onclick="openMenu()">â˜°</span>
  <span>Masar</span>
</div>

<div id="mobileMenu" class="mobile-menu">
  <div class="mobile-menu-close" onclick="closeMenu()">Ã—</div>
  <a href="main_dashboard.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="smart_beds.html">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø±Ø©</a>
  <a href="control_panel.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  <a href="transfer_requests.html">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
</div>

<header>
  <div class="header-title">
    <div style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">Masar</div>
    <div style="font-size: 16px; opacity: 0.9;">Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„</div>
  </div>
  <div class="header-actions">
    <a href="main_dashboard.html" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="smart_beds.html" class="nav-link">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø±Ø©</a>
    <a href="control_panel.html" class="nav-link">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  </div>
</header>

<div class="container">
  <!-- Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© -->
  <div class="card incoming-card">
    <div class="card-title">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© Ù…Ù† Ù…Ø³ØªØ´ÙÙŠØ§Øª Ø£Ø®Ø±Ù‰</div>
    <div id="incomingRequestsList"></div>
  </div>

  <!-- Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµØ§Ø¯Ø±Ø© -->
  <div class="card outgoing-card">
    <div class="card-title">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµØ§Ø¯Ø±Ø©</div>
    <div id="outgoingRequestsList"></div>
  </div>
</div>


<script>
/* ============================================================
  Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©
============================================================ */
const incomingRequests = [
  {
    id: "REQ001",
    fromHospital: "Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù†ÙˆØ± Ø§Ù„ØªØ®ØµØµÙŠ",
    patientName: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
    severity: "HIGH",
    reason: "ÙØ´Ù„ ØªÙ†ÙØ³ÙŠ ÙŠØ­ØªØ§Ø¬ Ø³Ø±ÙŠØ± Ø¹Ø²Ù„",
    timeRemaining: 15,
    needsIsolation: true
  },
  {
    id: "REQ002",
    fromHospital: "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø·Ø¨ÙŠØ©",
    patientName: "ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ",
    severity: "MEDIUM",
    reason: "Ø­Ø§Ø¬Ø© Ù„Ø±Ø¹Ø§ÙŠØ© Ù…ØªØ®ØµØµØ© ÙÙŠ Ø§Ù„Ù‚Ù„Ø¨",
    timeRemaining: 30,
    needsIsolation: false
  }
];

/* ============================================================
  Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµØ§Ø¯Ø±Ø©
============================================================ */
const outgoingRequests = [
  {
    id: "OUT001",
    toHospital: "Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù†ÙˆØ± Ø§Ù„ØªØ®ØµØµÙŠ",
    patientName: "Ø³Ø¹Ø§Ø¯ Ø£Ø­Ù…Ø¯",
    severity: "MEDIUM",
    reason: "Ø­Ø§Ø¬Ø© Ù„Ø±Ø¹Ø§ÙŠØ© Ù…ØªØ®ØµØµØ©",
    status: "pending",
    sentAt: "Ù…Ù†Ø° 10 Ø¯Ù‚Ø§Ø¦Ù‚"
  },
  {
    id: "OUT002",
    toHospital: "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø·Ø¨ÙŠØ©",
    patientName: "ÙˆÙØ§Ø¡ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ",
    severity: "HIGH",
    reason: "Ø­Ø§Ù„Ø© Ø­Ø±Ø¬Ø© ØªØ­ØªØ§Ø¬ Ø¹Ù†Ø§ÙŠØ© Ù…ÙƒØ«ÙØ©",
    status: "accepted",
    sentAt: "Ù…Ù†Ø° 25 Ø¯Ù‚ÙŠÙ‚Ø©"
  }
];

function buildIncomingRequests() {
  const container = document.getElementById("incomingRequestsList");
  container.innerHTML = "";

  if (incomingRequests.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon"></div>
        <div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ø±Ø¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>
      </div>
    `;
    return;
  }

  incomingRequests.forEach(req => {
    const card = document.createElement("div");
    card.className = "request-card";
    
    const aiDecision = checkAIAcceptance(req);
    
    card.innerHTML = `
      <div class="request-header">
        <div>
          <div class="request-title">Ø·Ù„Ø¨ Ù…Ù†: ${req.fromHospital}</div>
          <div class="request-meta">Ø§Ù„Ù…Ø±ÙŠØ¶: ${req.patientName}</div>
        </div>
        <div class="severity-badge severity-${req.severity.toLowerCase()}">
          ${req.severity === 'HIGH' ? 'Ø­Ø±Ø¬Ø©' : req.severity === 'MEDIUM' ? 'Ù…ØªÙˆØ³Ø·Ø©' : 'Ù…Ù†Ø®ÙØ¶Ø©'}
        </div>
      </div>
      <div style="font-size:13px; color:#555; margin-bottom:12px;">
        <strong>Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„:</strong> ${req.reason}
      </div>
      <div style="font-size:12px; color:#999; margin-bottom:12px;">
        Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø±Ø¯: <strong>${req.timeRemaining} Ø¯Ù‚ÙŠÙ‚Ø©</strong>
      </div>
      <div class="ai-recommendation">
        <div class="ai-recommendation-title">ØªÙˆØµÙŠØ© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:</div>
        <div class="ai-recommendation-text">
          ${aiDecision.message}
        </div>
      </div>
      <div class="request-actions">
        <button class="btn-action btn-accept" onclick="showVerification('${req.id}', 'accept')" 
                ${!aiDecision.canAccept ? 'disabled' : ''}>
          Ù‚Ø¨ÙˆÙ„
        </button>
        <button class="btn-action btn-reject" onclick="showVerification('${req.id}', 'reject')">
          Ø±ÙØ¶
        </button>
        <button class="btn-action btn-details" onclick="viewPatientDetails('${req.id}')">
          Ø§Ù„ØªÙØ§ØµÙŠÙ„
        </button>
      </div>
      <div id="verification-${req.id}" class="verification-section">
        <div class="verification-title">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© - ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</div>
        <div class="verification-input-group">
          <input type="password" id="verify-code-${req.id}" class="verification-input" placeholder="Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ (6 Ø£Ø±Ù‚Ø§Ù…)" maxlength="6" autocomplete="off" onkeypress="if(event.key === 'Enter') confirmVerification('${req.id}')">
          <button class="btn-verify btn-verify-confirm" onclick="confirmVerification('${req.id}')">ØªØ£ÙƒÙŠØ¯</button>
          <button class="btn-verify btn-verify-cancel" onclick="hideVerification('${req.id}')">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
        <div id="verify-error-${req.id}" class="verification-error"></div>
      </div>
    `;
    
    container.appendChild(card);
  });
}

function buildOutgoingRequests() {
  const container = document.getElementById("outgoingRequestsList");
  container.innerHTML = "";

  if (outgoingRequests.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon"></div>
        <div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØµØ§Ø¯Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>
      </div>
    `;
    return;
  }

  outgoingRequests.forEach(req => {
    const card = document.createElement("div");
    card.className = "request-card";
    
    const statusBadge = req.status === "accepted" 
      ? '<span style="color:#27ae60; font-weight:600;">Ù…Ù‚Ø¨ÙˆÙ„</span>'
      : req.status === "rejected"
      ? '<span style="color:#e74c3c; font-weight:600;">Ù…Ø±ÙÙˆØ¶</span>'
      : '<span style="color:#f39c12; font-weight:600;">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>';
    
    card.innerHTML = `
      <div class="request-header">
        <div>
          <div class="request-title">Ø·Ù„Ø¨ Ø¥Ù„Ù‰: ${req.toHospital}</div>
          <div class="request-meta">Ø§Ù„Ù…Ø±ÙŠØ¶: ${req.patientName} â€¢ ${req.sentAt}</div>
        </div>
        <div class="severity-badge severity-${req.severity.toLowerCase()}">
          ${req.severity === 'HIGH' ? 'Ø­Ø±Ø¬Ø©' : req.severity === 'MEDIUM' ? 'Ù…ØªÙˆØ³Ø·Ø©' : 'Ù…Ù†Ø®ÙØ¶Ø©'}
        </div>
      </div>
      <div style="font-size:13px; color:#555; margin-bottom:12px;">
        <strong>Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„:</strong> ${req.reason}
      </div>
      <div style="font-size:13px; color:#0a56b3; margin-bottom:12px; font-weight:600;">
        Ø§Ù„Ø­Ø§Ù„Ø©: ${statusBadge}
      </div>
      <div class="request-actions">
        <button class="btn-action btn-details" onclick="viewOutgoingDetails('${req.id}')" style="flex:1;">
          Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
        </button>
        ${req.status === "pending" ? `
          <button class="btn-action btn-reject" onclick="cancelRequest('${req.id}')" style="flex:1;">
            Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨
          </button>
        ` : ''}
      </div>
    `;
    
    container.appendChild(card);
  });
}

function checkAIAcceptance(request) {
  // Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ù†Ø·Ù‚ AI Ù„Ù„Ù‚Ø¨ÙˆÙ„/Ø§Ù„Ø±ÙØ¶
  const currentLoad = 88; // Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø­Ø§Ù„ÙŠ
  const currentRatio = 6.0; // Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ¶
  const hasIsolationBed = request.needsIsolation ? true : true; // Ù…Ø­Ø§ÙƒØ§Ø©
  
  // Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  if (request.severity === "HIGH" || request.severity === "CRITICAL") {
    return {
      canAccept: true,
      message: "ÙŠØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ â€” Ø§Ù„Ø­Ø§Ù„Ø© Ø­Ø±Ø¬Ø© ÙˆØªØªØ·Ù„Ø¨ Ù‚Ø¨ÙˆÙ„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ"
    };
  }
  
  if (currentLoad > 80) {
    return {
      canAccept: false,
      message: "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ â€” Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹ (" + currentLoad + "%)"
    };
  }
  
  if (currentRatio >= 6.5) {
    return {
      canAccept: false,
      message: "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ â€” Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ¶ Ù…Ø±ØªÙØ¹Ø© Ø¬Ø¯Ø§Ù‹ (1:" + currentRatio + ")"
    };
  }
  
  if (request.needsIsolation && !hasIsolationBed) {
    return {
      canAccept: false,
      message: "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ â€” Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø±ÙŠØ± Ø¹Ø²Ù„ Ù…ØªØ§Ø­"
    };
  }
  
  if (currentLoad <= 70 && currentRatio <= 6) {
    return {
      canAccept: true,
      message: "ÙŠØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ â€” Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØªØ³Ù…Ø­ Ø¨Ø°Ù„Ùƒ. Ø§Ù„Ø¬Ù†Ø§Ø­ 4B Ù„Ø¯ÙŠÙ‡ Ø³Ø±ÙŠØ± Ù…Ù†Ø§Ø³Ø¨ Ù…ØªØ§Ø­."
    };
  }
  
  return {
    canAccept: true,
    message: "ÙŠÙ…ÙƒÙ† Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ â€” Ù„ÙƒÙ† Ø§Ù„Ø¶ØºØ· Ù…ØªÙˆØ³Ø·. ÙŠÙÙ†ØµØ­ Ø¨Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©."
  };
}

// Verification system
const VERIFICATION_CODE = "123456"; // ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
let pendingActions = {}; // {requestId: 'accept' or 'reject'}

function showVerification(requestId, action) {
  // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ø®Ø±Ù‰
  document.querySelectorAll('.verification-section').forEach(section => {
    section.classList.remove('active');
  });
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
  const verificationSection = document.getElementById(`verification-${requestId}`);
  const input = document.getElementById(`verify-code-${requestId}`);
  const error = document.getElementById(`verify-error-${requestId}`);
  
  if (verificationSection) {
    pendingActions[requestId] = action;
    verificationSection.classList.add('active');
    if (input) {
      input.value = "";
      input.focus();
    }
    if (error) {
      error.textContent = "";
    }
  }
}

function hideVerification(requestId) {
  const verificationSection = document.getElementById(`verification-${requestId}`);
  const input = document.getElementById(`verify-code-${requestId}`);
  const error = document.getElementById(`verify-error-${requestId}`);
  
  if (verificationSection) {
    verificationSection.classList.remove('active');
    delete pendingActions[requestId];
  }
  if (input) input.value = "";
  if (error) error.textContent = "";
}

function confirmVerification(requestId) {
  const input = document.getElementById(`verify-code-${requestId}`);
  const error = document.getElementById(`verify-error-${requestId}`);
  const code = input ? input.value.trim() : "";
  
  if (!code) {
    if (error) error.textContent = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚";
    if (input) input.focus();
    return;
  }
  
  if (code.length < 6) {
    if (error) error.textContent = "Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 6 Ø£Ø±Ù‚Ø§Ù…";
    if (input) input.focus();
    return;
  }
  
  if (code !== VERIFICATION_CODE) {
    if (error) error.textContent = "Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
    if (input) {
      input.value = "";
      input.focus();
    }
    return;
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù†Ø¬Ø­
  const action = pendingActions[requestId];
  hideVerification(requestId);
  
  // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
  if (action === "accept") {
    executeAcceptRequest(requestId);
  } else if (action === "reject") {
    executeRejectRequest(requestId);
  }
}

let currentRequestId = null;

function executeAcceptRequest(requestId) {
  const req = incomingRequests.find(r => r.id === requestId);
  if (req) {
    currentRequestId = requestId;
    const modal = document.getElementById('acceptModal');
    const message = document.getElementById('acceptModalMessage');
    const details = document.getElementById('acceptModalDetails');
    
    message.textContent = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ØŸ`;
    details.innerHTML = `
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø±Ø³Ù„:</span>
        <span class="action-modal-detail-value">${req.fromHospital}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„Ù…Ø±ÙŠØ¶:</span>
        <span class="action-modal-detail-value">${req.patientName}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø§Ù„Ø©:</span>
        <span class="action-modal-detail-value">${req.severity === 'HIGH' ? 'Ø­Ø±Ø¬Ø©' : req.severity === 'MEDIUM' ? 'Ù…ØªÙˆØ³Ø·Ø©' : 'Ù…Ù†Ø®ÙØ¶Ø©'}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„:</span>
        <span class="action-modal-detail-value">${req.reason}</span>
      </div>
    `;
    
    modal.classList.add('active');
  }
}

function confirmAccept() {
  if (currentRequestId) {
    const req = incomingRequests.find(r => r.id === currentRequestId);
    if (req) {
      const index = incomingRequests.findIndex(r => r.id === currentRequestId);
      if (index > -1) {
        incomingRequests.splice(index, 1);
        buildIncomingRequests();
      }
      closeAcceptModal();
      
      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
      const modal = document.getElementById('acceptModal');
      const message = document.getElementById('acceptModalMessage');
      message.textContent = `âœ“ ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† ${req.fromHospital}`;
      setTimeout(() => {
        closeAcceptModal();
      }, 2000);
    }
  }
}

function closeAcceptModal() {
  document.getElementById('acceptModal').classList.remove('active');
  currentRequestId = null;
}

function executeRejectRequest(requestId) {
  const req = incomingRequests.find(r => r.id === requestId);
  if (req) {
    currentRequestId = requestId;
    const modal = document.getElementById('rejectModal');
    const message = document.getElementById('rejectModalMessage');
    const details = document.getElementById('rejectModalDetails');
    
    message.textContent = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ØŸ`;
    details.innerHTML = `
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø±Ø³Ù„:</span>
        <span class="action-modal-detail-value">${req.fromHospital}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„Ù…Ø±ÙŠØ¶:</span>
        <span class="action-modal-detail-value">${req.patientName}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø§Ù„Ø©:</span>
        <span class="action-modal-detail-value">${req.severity === 'HIGH' ? 'Ø­Ø±Ø¬Ø©' : req.severity === 'MEDIUM' ? 'Ù…ØªÙˆØ³Ø·Ø©' : 'Ù…Ù†Ø®ÙØ¶Ø©'}</span>
      </div>
    `;
    
    modal.classList.add('active');
  }
}

function confirmReject() {
  if (currentRequestId) {
    const req = incomingRequests.find(r => r.id === currentRequestId);
    if (req) {
      const index = incomingRequests.findIndex(r => r.id === currentRequestId);
      if (index > -1) {
        incomingRequests.splice(index, 1);
        buildIncomingRequests();
      }
      closeRejectModal();
      
      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
      const modal = document.getElementById('rejectModal');
      const message = document.getElementById('rejectModalMessage');
      message.textContent = `âœ— ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù† ${req.fromHospital}`;
      setTimeout(() => {
        closeRejectModal();
      }, 2000);
    }
  }
}

function closeRejectModal() {
  document.getElementById('rejectModal').classList.remove('active');
  currentRequestId = null;
}

function viewPatientDetails(requestId) {
  const req = incomingRequests.find(r => r.id === requestId);
  if (req) {
    const modal = document.getElementById('detailsModal');
    const content = document.getElementById('detailsModalContent');
    
    content.innerHTML = `
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„Ø§Ø³Ù…:</span>
        <span class="action-modal-detail-value">${req.patientName}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø±Ø³Ù„:</span>
        <span class="action-modal-detail-value">${req.fromHospital}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø§Ù„Ø©:</span>
        <span class="action-modal-detail-value">${req.severity === 'HIGH' ? 'Ø­Ø±Ø¬Ø©' : req.severity === 'MEDIUM' ? 'Ù…ØªÙˆØ³Ø·Ø©' : 'Ù…Ù†Ø®ÙØ¶Ø©'}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„:</span>
        <span class="action-modal-detail-value">${req.reason}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</span>
        <span class="action-modal-detail-value">${req.timeRemaining} Ø¯Ù‚ÙŠÙ‚Ø©</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">ÙŠØ­ØªØ§Ø¬ Ø³Ø±ÙŠØ± Ø¹Ø²Ù„:</span>
        <span class="action-modal-detail-value">${req.needsIsolation ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</span>
      </div>
    `;
    
    modal.classList.add('active');
  }
}

function closeDetailsModal() {
  document.getElementById('detailsModal').classList.remove('active');
}

let currentOutgoingRequestId = null;

function viewOutgoingDetails(requestId) {
  const req = outgoingRequests.find(r => r.id === requestId);
  if (req) {
    const modal = document.getElementById('detailsModal');
    const content = document.getElementById('detailsModalContent');
    
    content.innerHTML = `
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„:</span>
        <span class="action-modal-detail-value">${req.toHospital}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„Ù…Ø±ÙŠØ¶:</span>
        <span class="action-modal-detail-value">${req.patientName}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø§Ù„Ø©:</span>
        <span class="action-modal-detail-value">${req.severity === 'HIGH' ? 'Ø­Ø±Ø¬Ø©' : req.severity === 'MEDIUM' ? 'Ù…ØªÙˆØ³Ø·Ø©' : 'Ù…Ù†Ø®ÙØ¶Ø©'}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„:</span>
        <span class="action-modal-detail-value">${req.reason}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
        <span class="action-modal-detail-value">${req.status === 'accepted' ? 'Ù…Ù‚Ø¨ÙˆÙ„' : req.status === 'rejected' ? 'Ù…Ø±ÙÙˆØ¶' : 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:</span>
        <span class="action-modal-detail-value">${req.sentAt}</span>
      </div>
    `;
    
    modal.classList.add('active');
  }
}

function cancelRequest(requestId) {
  const req = outgoingRequests.find(r => r.id === requestId);
  if (req) {
    currentOutgoingRequestId = requestId;
    const modal = document.getElementById('cancelModal');
    const message = document.getElementById('cancelModalMessage');
    const details = document.getElementById('cancelModalDetails');
    
    message.textContent = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ØŸ`;
    details.innerHTML = `
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„:</span>
        <span class="action-modal-detail-value">${req.toHospital}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø§Ù„Ù…Ø±ÙŠØ¶:</span>
        <span class="action-modal-detail-value">${req.patientName}</span>
      </div>
      <div class="action-modal-detail-row">
        <span class="action-modal-detail-label">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø§Ù„Ø©:</span>
        <span class="action-modal-detail-value">${req.severity === 'HIGH' ? 'Ø­Ø±Ø¬Ø©' : req.severity === 'MEDIUM' ? 'Ù…ØªÙˆØ³Ø·Ø©' : 'Ù…Ù†Ø®ÙØ¶Ø©'}</span>
      </div>
    `;
    
    modal.classList.add('active');
  }
}

function confirmCancel() {
  if (currentOutgoingRequestId) {
    const req = outgoingRequests.find(r => r.id === currentOutgoingRequestId);
    if (req) {
      const index = outgoingRequests.findIndex(r => r.id === currentOutgoingRequestId);
      if (index > -1) {
        outgoingRequests.splice(index, 1);
        buildOutgoingRequests();
      }
      closeCancelModal();
      
      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
      const modal = document.getElementById('cancelModal');
      const message = document.getElementById('cancelModalMessage');
      message.textContent = `âœ“ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­`;
      setTimeout(() => {
        closeCancelModal();
      }, 2000);
    }
  }
}

function closeCancelModal() {
  document.getElementById('cancelModal').classList.remove('active');
  currentOutgoingRequestId = null;
}

/* ============================================================
  ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
============================================================ */
buildIncomingRequests();
buildOutgoingRequests();
</script>

<script>
  // Page Access Protection
  const ACCESS_CODE = "123456"; // Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ØµÙØ­Ø©
  
  function checkAccess() {
    const input = document.getElementById('accessCode');
    const error = document.getElementById('accessError');
    const code = input.value.trim();
    
    if (!code) {
      error.textContent = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚";
      input.focus();
      return;
    }
    
    if (code.length < 6) {
      error.textContent = "Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 6 Ø£Ø±Ù‚Ø§Ù…";
      input.focus();
      return;
    }
    
    if (code !== ACCESS_CODE) {
      error.textContent = "Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
      input.value = "";
      input.focus();
      return;
    }
    
    // Ø§Ù„Ø±Ù…Ø² ØµØ­ÙŠØ­ - Ø¥Ø®ÙØ§Ø¡ ØµÙØ­Ø© Ø§Ù„Ø­Ù…Ø§ÙŠØ©
    document.getElementById('accessProtection').classList.add('hidden');
  }
  
  // Ø¥Ø¸Ù‡Ø§Ø± ØµÙØ­Ø© Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙÙŠ ÙƒÙ„ Ù…Ø±Ø© ÙŠØªÙ… ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
  window.addEventListener('DOMContentLoaded', () => {
    document.getElementById('accessProtection').classList.remove('hidden');
    document.getElementById('accessCode').focus();
  });

  function openMenu() {
    const menu = document.getElementById('mobileMenu');
    if (menu) {
      menu.style.display = 'block';
    }
  }

  function closeMenu() {
    const menu = document.getElementById('mobileMenu');
    if (menu) {
      menu.style.display = 'none';
    }
  }
</script>

</body>
</html>

